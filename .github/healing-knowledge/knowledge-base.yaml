# ğŸ”§ CI è‡ªé«”ä¿®å¾©çŸ¥è­˜åº«
# Self-Healing CI Knowledge Base

version: "1.0.0"
last_updated: "2025-12-04"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# å·²çŸ¥å•é¡Œæ¨¡å¼ (Known Issue Patterns)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
patterns:
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # Workflow èªæ³•éŒ¯èª¤
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - id: "WF001"
    name: "hashFiles in job-level if"
    description: "hashFiles() å‡½æ•¸åœ¨ job å±¤ç´šçš„ if æ¢ä»¶ä¸­ä½¿ç”¨æœƒå°è‡´ startup_failure"
    error_signature:
      - "startup_failure"
      - "workflow file issue"
    detection_regex: "^\\s+if:.*hashFiles.*(?<!steps\\.)"
    severity: critical
    auto_fixable: true
    fix_strategy: |
      å°‡ hashFiles() æ¢ä»¶ç§»åˆ° step å±¤ç´šï¼Œæˆ–ä½¿ç”¨ paths-filter actionï¼š
      1. ä½¿ç”¨ dorny/paths-filter@v3 åœ¨ç¨ç«‹ job ä¸­æª¢æ¸¬è®Šæ›´
      2. å°‡çµæœä½œç‚º output å‚³éçµ¦å…¶ä»– jobs
      3. åœ¨ jobs çš„ if æ¢ä»¶ä¸­ä½¿ç”¨ needs.detect.outputs.xxx
    example_fix: |
      # éŒ¯èª¤ç”¨æ³•ï¼š
      jobs:
        test:
          if: ${{ hashFiles('**/*.ts') != '' }}  # âŒ é€™æœƒå°è‡´ startup_failure
          
      # æ­£ç¢ºç”¨æ³•ï¼š
      jobs:
        detect:
          outputs:
            typescript: ${{ steps.filter.outputs.typescript }}
          steps:
            - uses: dorny/paths-filter@v3
              id: filter
              with:
                filters: |
                  typescript:
                    - '**/*.ts'
        test:
          needs: detect
          if: ${{ needs.detect.outputs.typescript == 'true' }}  # âœ…
    references:
      - "https://docs.github.com/en/actions/learn-github-actions/expressions#hashfiles"
      - "https://github.com/dorny/paths-filter"

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # NPM ç›¸é—œå•é¡Œ
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - id: "NPM001"
    name: "npm install failure"
    description: "NPM å®‰è£å¤±æ•—ï¼Œé€šå¸¸ç”±æ–¼ lock file ä¸ä¸€è‡´æˆ– registry å•é¡Œ"
    error_signature:
      - "npm ERR!"
      - "ENOENT"
      - "package-lock.json"
    severity: high
    auto_fixable: true
    fix_strategy: |
      1. åˆªé™¤ node_modules å’Œ package-lock.json
      2. é‡æ–°åŸ·è¡Œ npm install
      3. æäº¤æ›´æ–°å¾Œçš„ package-lock.json
    commands:
      - "rm -rf node_modules package-lock.json"
      - "npm install"
      - "git add package-lock.json"

  - id: "NPM002"
    name: "npm cache issue"
    description: "NPM ç·©å­˜æå£æˆ–ä¸ä¸€è‡´"
    error_signature:
      - "npm WARN"
      - "cache"
      - "integrity"
    severity: medium
    auto_fixable: true
    fix_strategy: |
      æ¸…é™¤ NPM ç·©å­˜ä¸¦é‡æ–°å®‰è£
    commands:
      - "npm cache clean --force"
      - "npm install"

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # æ¬Šé™å•é¡Œ
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - id: "PERM001"
    name: "GitHub Token permission"
    description: "GITHUB_TOKEN æ¬Šé™ä¸è¶³"
    error_signature:
      - "permission denied"
      - "Resource not accessible"
      - "403"
    severity: high
    auto_fixable: false
    fix_strategy: |
      åœ¨ workflow ä¸­æ·»åŠ æ­£ç¢ºçš„ permissionsï¼š
      ```yaml
      permissions:
        contents: write
        pull-requests: write
        issues: write
      ```
    manual_steps:
      - "æª¢æŸ¥ workflow çš„ permissions è¨­å®š"
      - "ç¢ºèª repository çš„ Actions è¨­å®šå…è¨±æ‰€éœ€æ¬Šé™"
      - "è€ƒæ…®ä½¿ç”¨ PAT (Personal Access Token) å¦‚æœéœ€è¦æ›´é«˜æ¬Šé™"

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # å»ºç½®å•é¡Œ
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - id: "BUILD001"
    name: "TypeScript compilation error"
    description: "TypeScript ç·¨è­¯éŒ¯èª¤"
    error_signature:
      - "error TS"
      - "Cannot find module"
      - "Type error"
    severity: high
    auto_fixable: false
    fix_strategy: |
      1. æª¢æŸ¥ TypeScript éŒ¯èª¤è¨Šæ¯
      2. ä¿®å¾©å‹åˆ¥éŒ¯èª¤
      3. ç¢ºä¿æ‰€æœ‰ dependencies å·²å®‰è£
    diagnostics:
      - "npx tsc --noEmit"
      - "npm run lint"

  - id: "BUILD002"
    name: "Rust compilation error"
    description: "Rust ç·¨è­¯éŒ¯èª¤"
    error_signature:
      - "error[E"
      - "cargo build"
      - "cannot find"
    severity: high
    auto_fixable: false
    fix_strategy: |
      1. æª¢æŸ¥ Rust ç·¨è­¯éŒ¯èª¤
      2. åŸ·è¡Œ cargo clippy æª¢æŸ¥
      3. ç¢ºä¿ Cargo.lock æ˜¯æœ€æ–°çš„
    diagnostics:
      - "cargo check"
      - "cargo clippy"

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # æ¸¬è©¦å•é¡Œ
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - id: "TEST001"
    name: "Test failure"
    description: "æ¸¬è©¦å¤±æ•—"
    error_signature:
      - "FAILED"
      - "AssertionError"
      - "Expected"
    severity: medium
    auto_fixable: false
    fix_strategy: |
      1. æŸ¥çœ‹å¤±æ•—çš„æ¸¬è©¦æ¡ˆä¾‹
      2. æª¢æŸ¥æ¸¬è©¦é‚è¼¯å’Œæ•¸æ“š
      3. ç¢ºèªæ˜¯å¦ç‚ºç’°å¢ƒå•é¡Œ
    investigation_steps:
      - "æŸ¥çœ‹æ¸¬è©¦è¼¸å‡ºæ—¥èªŒ"
      - "æœ¬åœ°é‡ç¾å•é¡Œ"
      - "æª¢æŸ¥æœ€è¿‘çš„ç¨‹å¼ç¢¼è®Šæ›´"

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # è¶…æ™‚å•é¡Œ
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - id: "TIMEOUT001"
    name: "Job timeout"
    description: "Job åŸ·è¡Œè¶…æ™‚"
    error_signature:
      - "timeout"
      - "cancelled"
      - "exceeded"
    severity: medium
    auto_fixable: false
    fix_strategy: |
      1. å¢åŠ  timeout-minutes è¨­å®š
      2. å„ªåŒ–é•·æ™‚é–“é‹è¡Œçš„æ­¥é©Ÿ
      3. è€ƒæ…®æ‹†åˆ†ç‚ºå¤šå€‹ jobs
    example_fix: |
      jobs:
        build:
          timeout-minutes: 60  # é è¨­æ˜¯ 360 åˆ†é˜
          steps:
            - name: Long running step
              timeout-minutes: 30

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ä¿®å¾©æ­·å²è¨˜éŒ„ (Fix History)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
fix_history:
  - date: "2025-12-04"
    issue_id: "WF001"
    file: ".github/workflows/02-test.yml"
    description: "ä¿®å¾© hashFiles() åœ¨ job å±¤ç´šçš„ä½¿ç”¨å•é¡Œ"
    commit: "pending"
    status: "fixed"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# é é˜²æªæ–½ (Preventive Measures)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
preventive_measures:
  - name: "Workflow èªæ³•æª¢æŸ¥"
    description: "åœ¨ PR ä¸­è‡ªå‹•æª¢æŸ¥ workflow èªæ³•"
    implementation: |
      ä½¿ç”¨ actionlint åœ¨ CI ä¸­é©—è­‰ workflow æª”æ¡ˆ
    tools:
      - "actionlint"
      - "yamllint"

  - name: "ä¾è³´é–å®š"
    description: "ç¢ºä¿ä¾è³´ç‰ˆæœ¬é–å®š"
    implementation: |
      - æäº¤ package-lock.json
      - ä½¿ç”¨ npm ci è€Œé npm install
      - å®šæœŸæ›´æ–°ä¾è³´

  - name: "æ¸¬è©¦è¦†è“‹ç‡ç›£æ§"
    description: "ç›£æ§æ¸¬è©¦è¦†è“‹ç‡è®ŠåŒ–"
    implementation: |
      - è¨­å®šè¦†è“‹ç‡é–¾å€¼
      - åœ¨ PR ä¸­é¡¯ç¤ºè¦†è“‹ç‡å ±å‘Š
      - é˜²æ­¢è¦†è“‹ç‡ä¸‹é™

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# è‡ªå‹•ä¿®å¾©é…ç½® (Auto-Fix Configuration)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
auto_fix_config:
  enabled: true
  max_attempts: 3
  cooldown_minutes: 30

  # å…è¨±è‡ªå‹•ä¿®å¾©çš„å•é¡Œé¡å‹
  allowed_patterns:
    - "WF001"
    - "NPM001"
    - "NPM002"

  # éœ€è¦äººå·¥ä»‹å…¥çš„å•é¡Œé¡å‹
  manual_required:
    - "PERM001"
    - "BUILD001"
    - "BUILD002"
    - "TEST001"

  # é€šçŸ¥è¨­å®š
  notifications:
    create_issue: true
    issue_labels:
      - "ci-failure"
      - "auto-detected"
    mention_maintainers: false
