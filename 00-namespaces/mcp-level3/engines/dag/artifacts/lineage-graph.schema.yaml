# Lineage Graph Artifact Schema
# Defines the structure for artifact lineage tracking in DAG workflows

version: "1.0.0"
semantic_role: "lineage_graph"
artifact_type: "schema"
semantic_root: true

metadata:
  name: "lineage-graph"
  description: "Schema for tracking artifact lineage and data provenance in workflows"
  author: "MCP Core Team"
  created: "2025-01-11"
  updated: "2025-01-11"
  tags:
    - "dag"
    - "lineage"
    - "provenance"
    - "traceability"

schema:
  type: "object"
  required:
    - "lineage_id"
    - "root_artifact"
    - "nodes"
    - "edges"
    - "metadata"
  properties:
    lineage_id:
      type: "string"
      description: "Unique identifier for the lineage graph"
      pattern: "^lineage:[a-zA-Z0-9_-]+:[0-9]+$"
      example: "lineage:artifact123:001"
      
    root_artifact:
      type: "object"
      description: "Root artifact being traced"
      required:
        - "artifact_id"
        - "artifact_type"
      properties:
        artifact_id:
          type: "string"
          example: "artifact:model:v1.0"
        artifact_type:
          type: "string"
          example: "ml_model"
        created_at:
          type: "string"
          format: "date-time"
          
    nodes:
      type: "array"
      description: "Artifacts in the lineage graph"
      items:
        type: "object"
        required:
          - "node_id"
          - "artifact_id"
          - "artifact_type"
        properties:
          node_id:
            type: "string"
            example: "node:001"
          artifact_id:
            type: "string"
            example: "artifact:dataset:raw"
          artifact_type:
            type: "string"
            example: "dataset"
          operation:
            type: "string"
            example: "data_ingestion"
          timestamp:
            type: "string"
            format: "date-time"
          metadata:
            type: "object"
            additionalProperties: true
            
    edges:
      type: "array"
      description: "Lineage relationships between artifacts"
      items:
        type: "object"
        required:
          - "edge_id"
          - "source"
          - "target"
          - "relationship_type"
        properties:
          edge_id:
            type: "string"
            example: "edge:001"
          source:
            type: "string"
            example: "node:001"
          target:
            type: "string"
            example: "node:002"
          relationship_type:
            type: "string"
            enum: ["derived_from", "transformed_by", "generated_by", "consumed_by"]
            example: "derived_from"
          operation:
            type: "string"
            example: "preprocessing"
          timestamp:
            type: "string"
            format: "date-time"
            
    metadata:
      type: "object"
      required:
        - "created_at"
        - "dag_id"
      properties:
        created_at:
          type: "string"
          format: "date-time"
        dag_id:
          type: "string"
          example: "dag:ml_pipeline:001"
        execution_id:
          type: "string"
          example: "exec:20250111_100000"
        depth:
          type: "integer"
          description: "Maximum depth of lineage graph"
          minimum: 0
          example: 5

validation_rules:
  - rule: "lineage_id_format"
    description: "Lineage ID must follow naming convention"
    expression: "lineage_id matches pattern 'lineage:artifact:version'"
    
  - rule: "valid_references"
    description: "All edges must reference existing nodes"
    expression: "all edges reference valid node_ids"

examples:
  - name: "ml_model_lineage"
    description: "Lineage graph for ML model"
    data:
      lineage_id: "lineage:model_v1:001"
      root_artifact:
        artifact_id: "artifact:model:v1.0"
        artifact_type: "ml_model"
        created_at: "2025-01-11T12:00:00Z"
      nodes:
        - node_id: "node:001"
          artifact_id: "artifact:dataset:raw"
          artifact_type: "dataset"
          operation: "data_ingestion"
          timestamp: "2025-01-11T10:00:00Z"
        - node_id: "node:002"
          artifact_id: "artifact:dataset:processed"
          artifact_type: "dataset"
          operation: "preprocessing"
          timestamp: "2025-01-11T10:30:00Z"
        - node_id: "node:003"
          artifact_id: "artifact:model:v1.0"
          artifact_type: "ml_model"
          operation: "training"
          timestamp: "2025-01-11T12:00:00Z"
      edges:
        - edge_id: "edge:001"
          source: "node:001"
          target: "node:002"
          relationship_type: "transformed_by"
          operation: "preprocessing"
          timestamp: "2025-01-11T10:30:00Z"
        - edge_id: "edge:002"
          source: "node:002"
          target: "node:003"
          relationship_type: "generated_by"
          operation: "training"
          timestamp: "2025-01-11T12:00:00Z"
      metadata:
        created_at: "2025-01-11T12:05:00Z"
        dag_id: "dag:ml_pipeline:001"
        execution_id: "exec:20250111_100000"
        depth: 2

usage_guidelines:
  - "Track all artifact transformations"
  - "Maintain temporal ordering of operations"
  - "Include operation metadata for debugging"
  - "Use consistent artifact naming"