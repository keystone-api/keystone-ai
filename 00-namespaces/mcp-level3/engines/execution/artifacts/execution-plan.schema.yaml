# Execution Plan Artifact Schema
# Defines the structure for workflow execution plans

version: "1.0.0"
semantic_role: "execution_plan"
artifact_type: "schema"
semantic_root: true

metadata:
  name: "execution-plan"
  description: "Schema for workflow execution plans with scheduling and resource allocation"
  author: "MCP Core Team"
  created: "2025-01-11"
  updated: "2025-01-11"
  tags:
    - "execution"
    - "workflow"
    - "scheduling"
    - "orchestration"

schema:
  type: "object"
  required:
    - "plan_id"
    - "dag_id"
    - "execution_id"
    - "tasks"
    - "schedule"
    - "metadata"
  properties:
    plan_id:
      type: "string"
      description: "Unique identifier for the execution plan"
      pattern: "^plan:[a-zA-Z0-9_-]+:[0-9]+$"
      example: "plan:ml_pipeline:20250111_100000"
      
    dag_id:
      type: "string"
      description: "Reference to the DAG definition"
      example: "dag:ml_pipeline:001"
      
    execution_id:
      type: "string"
      description: "Unique execution identifier"
      pattern: "^exec:[0-9]{8}_[0-9]{6}$"
      example: "exec:20250111_100000"
      
    tasks:
      type: "array"
      description: "Ordered list of tasks to execute"
      minItems: 1
      items:
        type: "object"
        required:
          - "task_id"
          - "node_id"
          - "scheduled_start"
        properties:
          task_id:
            type: "string"
            example: "task:ingest_data"
          node_id:
            type: "string"
            example: "node:data_ingestion"
          scheduled_start:
            type: "string"
            format: "date-time"
            example: "2025-01-11T10:00:00Z"
          estimated_duration_seconds:
            type: "integer"
            minimum: 1
            example: 300
          dependencies:
            type: "array"
            items:
              type: "string"
            example: ["task:validate_data"]
          resources:
            type: "object"
            properties:
              cpu:
                type: "string"
                example: "2"
              memory:
                type: "string"
                example: "4Gi"
              gpu:
                type: "integer"
                example: 0
          retry_policy:
            type: "object"
            properties:
              max_retries:
                type: "integer"
                default: 3
              retry_delay_seconds:
                type: "integer"
                default: 60
                
    schedule:
      type: "object"
      description: "Execution schedule"
      required:
        - "start_time"
        - "scheduling_strategy"
      properties:
        start_time:
          type: "string"
          format: "date-time"
          example: "2025-01-11T10:00:00Z"
        end_time:
          type: "string"
          format: "date-time"
          example: "2025-01-11T12:00:00Z"
        scheduling_strategy:
          type: "string"
          enum: ["sequential", "parallel", "priority", "resource_aware"]
          example: "resource_aware"
        max_parallelism:
          type: "integer"
          minimum: 1
          default: 10
          example: 5
          
    metadata:
      type: "object"
      required:
        - "created_at"
        - "created_by"
      properties:
        created_at:
          type: "string"
          format: "date-time"
          example: "2025-01-11T09:55:00Z"
        created_by:
          type: "string"
          example: "system:scheduler"
        priority:
          type: "integer"
          minimum: 0
          default: 0
          example: 10
        tags:
          type: "array"
          items:
            type: "string"
          example: ["ml", "production"]

validation_rules:
  - rule: "plan_id_format"
    description: "Plan ID must follow naming convention"
    expression: "plan_id matches pattern 'plan:dag:timestamp'"
    
  - rule: "valid_dependencies"
    description: "All task dependencies must reference existing tasks"
    expression: "all dependencies reference valid task_ids"

examples:
  - name: "ml_pipeline_execution_plan"
    description: "Execution plan for ML training pipeline"
    data:
      plan_id: "plan:ml_pipeline:20250111_100000"
      dag_id: "dag:ml_pipeline:001"
      execution_id: "exec:20250111_100000"
      tasks:
        - task_id: "task:ingest_data"
          node_id: "node:data_ingestion"
          scheduled_start: "2025-01-11T10:00:00Z"
          estimated_duration_seconds: 300
          dependencies: []
          resources:
            cpu: "2"
            memory: "4Gi"
        - task_id: "task:train_model"
          node_id: "node:model_training"
          scheduled_start: "2025-01-11T10:10:00Z"
          estimated_duration_seconds: 3600
          dependencies: ["task:ingest_data"]
          resources:
            cpu: "8"
            memory: "32Gi"
            gpu: 1
      schedule:
        start_time: "2025-01-11T10:00:00Z"
        end_time: "2025-01-11T12:00:00Z"
        scheduling_strategy: "resource_aware"
        max_parallelism: 5
      metadata:
        created_at: "2025-01-11T09:55:00Z"
        created_by: "system:scheduler"
        priority: 10
        tags: ["ml", "production"]

usage_guidelines:
  - "Create execution plans before workflow execution"
  - "Consider resource availability when scheduling"
  - "Set appropriate retry policies"
  - "Monitor execution against plan"