# Policy Definition Artifact Schema
# Defines the structure for governance policies in MCP Level 3

version: "1.0.0"
semantic_role: "policy_definition"
artifact_type: "schema"
semantic_root: true

metadata:
  name: "policy-definition"
  description: "Schema for policy-as-code definitions for governance and compliance"
  author: "MCP Core Team"
  created: "2025-01-11"
  updated: "2025-01-11"
  tags:
    - "governance"
    - "policy"
    - "compliance"
    - "security"

schema:
  type: "object"
  required:
    - "policy_id"
    - "name"
    - "version"
    - "policy_type"
    - "rules"
    - "metadata"
  properties:
    policy_id:
      type: "string"
      description: "Unique identifier for the policy"
      pattern: "^policy:[a-zA-Z0-9_-]+:[0-9]+$"
      example: "policy:data_access:001"
      
    name:
      type: "string"
      description: "Human-readable policy name"
      minLength: 1
      maxLength: 255
      example: "Data Access Control Policy"
      
    version:
      type: "string"
      description: "Semantic version of the policy"
      pattern: "^[0-9]+\\.[0-9]+\\.[0-9]+$"
      example: "1.0.0"
      
    description:
      type: "string"
      description: "Detailed policy description"
      example: "Controls access to sensitive data based on user roles and data classification"
      
    policy_type:
      type: "string"
      description: "Type of policy"
      enum: ["access_control", "data_governance", "security", "compliance", "operational", "quality"]
      example: "access_control"
      
    scope:
      type: "object"
      description: "Policy scope and applicability"
      properties:
        resources:
          type: "array"
          description: "Resources this policy applies to"
          items:
            type: "string"
          example: ["artifact:*", "dag:*"]
        actions:
          type: "array"
          description: "Actions this policy governs"
          items:
            type: "string"
          example: ["read", "write", "execute", "delete"]
        principals:
          type: "array"
          description: "Principals (users/roles) this policy applies to"
          items:
            type: "string"
          example: ["role:data_scientist", "user:*"]
        environments:
          type: "array"
          description: "Environments where policy applies"
          items:
            type: "string"
          example: ["production", "staging"]
          
    rules:
      type: "array"
      description: "Policy rules"
      minItems: 1
      items:
        type: "object"
        required:
          - "rule_id"
          - "condition"
          - "effect"
        properties:
          rule_id:
            type: "string"
            description: "Unique rule identifier"
            example: "rule:001"
            
          name:
            type: "string"
            description: "Rule name"
            example: "Restrict PII Access"
            
          description:
            type: "string"
            description: "Rule description"
            example: "Prevent unauthorized access to personally identifiable information"
            
          condition:
            type: "object"
            description: "Condition for rule evaluation"
            required:
              - "expression"
            properties:
              expression:
                type: "string"
                description: "Boolean expression"
                example: "resource.classification == 'PII' AND principal.role NOT IN ['admin', 'compliance_officer']"
              language:
                type: "string"
                description: "Expression language"
                enum: ["cel", "rego", "python", "jsonlogic"]
                default: "cel"
                example: "cel"
                
          effect:
            type: "string"
            description: "Effect when condition is true"
            enum: ["allow", "deny", "audit", "warn"]
            example: "deny"
            
          priority:
            type: "integer"
            description: "Rule priority (higher = evaluated first)"
            minimum: 0
            default: 0
            example: 100
            
          actions:
            type: "array"
            description: "Actions this rule applies to"
            items:
              type: "string"
            example: ["read", "write"]
            
          metadata:
            type: "object"
            description: "Additional rule metadata"
            additionalProperties: true
            
    enforcement:
      type: "object"
      description: "Policy enforcement configuration"
      properties:
        mode:
          type: "string"
          description: "Enforcement mode"
          enum: ["enforcing", "permissive", "audit_only"]
          default: "enforcing"
          example: "enforcing"
          
        on_violation:
          type: "object"
          description: "Actions on policy violation"
          properties:
            action:
              type: "string"
              enum: ["block", "warn", "log"]
              example: "block"
            notification:
              type: "array"
              items:
                type: "string"
              example: ["email:security@example.com", "slack:security-alerts"]
            escalation:
              type: "object"
              properties:
                enabled:
                  type: "boolean"
                  example: true
                threshold:
                  type: "integer"
                  description: "Number of violations before escalation"
                  example: 3
                  
    compliance:
      type: "object"
      description: "Compliance framework mapping"
      properties:
        frameworks:
          type: "array"
          description: "Compliance frameworks this policy supports"
          items:
            type: "object"
            properties:
              name:
                type: "string"
                example: "GDPR"
              article:
                type: "string"
                example: "Article 32"
              requirement:
                type: "string"
                example: "Security of processing"
          example:
            - name: "GDPR"
              article: "Article 32"
              requirement: "Security of processing"
            - name: "SOC2"
              article: "CC6.1"
              requirement: "Logical and Physical Access Controls"
              
    metadata:
      type: "object"
      required:
        - "created_at"
        - "created_by"
      properties:
        created_at:
          type: "string"
          format: "date-time"
          example: "2025-01-11T10:00:00Z"
          
        created_by:
          type: "string"
          example: "user:security_admin"
          
        updated_at:
          type: "string"
          format: "date-time"
          example: "2025-01-11T12:00:00Z"
          
        updated_by:
          type: "string"
          example: "user:compliance_officer"
          
        owner:
          type: "string"
          example: "team:security"
          
        tags:
          type: "array"
          items:
            type: "string"
          example: ["security", "pii", "gdpr"]
          
        status:
          type: "string"
          enum: ["draft", "active", "deprecated", "archived"]
          default: "draft"
          example: "active"
          
        approval:
          type: "object"
          properties:
            required:
              type: "boolean"
              example: true
            approved_by:
              type: "string"
              example: "user:ciso"
            approved_at:
              type: "string"
              format: "date-time"
              example: "2025-01-11T11:00:00Z"

validation_rules:
  - rule: "policy_id_format"
    description: "Policy ID must follow naming convention"
    expression: "policy_id matches pattern 'policy:name:version'"
    
  - rule: "unique_rule_ids"
    description: "All rule IDs must be unique within policy"
    expression: "rule_ids are unique"
    
  - rule: "valid_effect"
    description: "Rule effect must be valid"
    expression: "effect in ['allow', 'deny', 'audit', 'warn']"

examples:
  - name: "data_access_policy"
    description: "Policy for controlling access to sensitive data"
    data:
      policy_id: "policy:data_access:001"
      name: "Data Access Control Policy"
      version: "1.0.0"
      description: "Controls access to sensitive data based on user roles and data classification"
      policy_type: "access_control"
      scope:
        resources: ["artifact:dataset:*", "artifact:model:*"]
        actions: ["read", "write", "delete"]
        principals: ["role:*"]
        environments: ["production", "staging"]
      rules:
        - rule_id: "rule:001"
          name: "Restrict PII Access"
          description: "Prevent unauthorized access to PII data"
          condition:
            expression: "resource.classification == 'PII' AND principal.role NOT IN ['admin', 'compliance_officer']"
            language: "cel"
          effect: "deny"
          priority: 100
          actions: ["read", "write"]
        - rule_id: "rule:002"
          name: "Audit Sensitive Operations"
          description: "Audit all operations on sensitive data"
          condition:
            expression: "resource.classification IN ['PII', 'PHI', 'Financial']"
            language: "cel"
          effect: "audit"
          priority: 50
          actions: ["read", "write", "delete"]
      enforcement:
        mode: "enforcing"
        on_violation:
          action: "block"
          notification: ["email:security@example.com"]
          escalation:
            enabled: true
            threshold: 3
      compliance:
        frameworks:
          - name: "GDPR"
            article: "Article 32"
            requirement: "Security of processing"
      metadata:
        created_at: "2025-01-11T10:00:00Z"
        created_by: "user:security_admin"
        owner: "team:security"
        tags: ["security", "pii", "gdpr"]
        status: "active"
        approval:
          required: true
          approved_by: "user:ciso"
          approved_at: "2025-01-11T11:00:00Z"

usage_guidelines:
  - "Define clear, specific policy rules"
  - "Use appropriate enforcement modes for different environments"
  - "Map policies to compliance frameworks"
  - "Require approval for production policies"
  - "Version policies for change tracking"
  - "Test policies in permissive mode before enforcing"

performance_considerations:
  - "Optimize rule evaluation order by priority"
  - "Cache policy evaluation results"
  - "Use efficient expression languages (CEL)"
  - "Index policies by scope for fast lookup"