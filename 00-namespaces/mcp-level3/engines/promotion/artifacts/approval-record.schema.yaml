# Approval Record Artifact Schema
# Defines the structure for promotion approval records

version: "1.0.0"
semantic_role: "approval_record"
artifact_type: "schema"
semantic_root: true

metadata:
  name: "approval-record"
  description: "Schema for tracking promotion approvals with multi-approver support"
  author: "MCP Core Team"
  created: "2025-01-11"
  updated: "2025-01-11"
  tags:
    - "promotion"
    - "approval"
    - "workflow"
    - "governance"

schema:
  type: "object"
  required:
    - "record_id"
    - "promotion_plan_id"
    - "approval_status"
    - "approvers"
    - "metadata"
  properties:
    record_id:
      type: "string"
      pattern: "^record:[a-zA-Z0-9_-]+:[0-9]+$"
      example: "record:approval:20250111_100000"
      
    promotion_plan_id:
      type: "string"
      description: "Reference to promotion plan"
      example: "plan:promotion:20250111_100000"
      
    approval_status:
      type: "string"
      description: "Overall approval status"
      enum: ["pending", "approved", "rejected", "expired"]
      example: "approved"
      
    approvers:
      type: "array"
      description: "List of approvers"
      minItems: 1
      items:
        type: "object"
        required:
          - "approver_id"
          - "status"
        properties:
          approver_id:
            type: "string"
            example: "user:tech_lead"
          approver_name:
            type: "string"
            example: "John Doe"
          role:
            type: "string"
            example: "Tech Lead"
          status:
            type: "string"
            enum: ["pending", "approved", "rejected"]
            example: "approved"
          decision_at:
            type: "string"
            format: "date-time"
            example: "2025-01-11T10:30:00Z"
          comments:
            type: "string"
            example: "Approved after reviewing validation results"
          conditions:
            type: "array"
            description: "Approval conditions"
            items:
              type: "string"
            example: ["Must pass security scan", "Requires canary deployment"]
            
    approval_policy:
      type: "object"
      description: "Approval policy requirements"
      properties:
        required_approvals:
          type: "integer"
          description: "Minimum number of approvals required"
          minimum: 1
          example: 2
        approval_type:
          type: "string"
          enum: ["all", "majority", "any"]
          default: "all"
          example: "majority"
        timeout_hours:
          type: "integer"
          description: "Hours before approval expires"
          minimum: 1
          example: 48
          
    metadata:
      type: "object"
      required:
        - "created_at"
        - "requested_by"
      properties:
        created_at:
          type: "string"
          format: "date-time"
          example: "2025-01-11T10:00:00Z"
        requested_by:
          type: "string"
          example: "user:ml_engineer"
        expires_at:
          type: "string"
          format: "date-time"
          example: "2025-01-13T10:00:00Z"
        completed_at:
          type: "string"
          format: "date-time"
          example: "2025-01-11T11:00:00Z"

validation_rules:
  - rule: "record_id_format"
    description: "Record ID must follow naming convention"
    expression: "record_id matches pattern 'record:type:timestamp'"
    
  - rule: "approval_count"
    description: "Number of approvals must meet policy requirements"
    expression: "approved_count >= approval_policy.required_approvals"

examples:
  - name: "multi_approver_record"
    description: "Approval record with multiple approvers"
    data:
      record_id: "record:approval:20250111_100000"
      promotion_plan_id: "plan:promotion:20250111_100000"
      approval_status: "approved"
      approvers:
        - approver_id: "user:tech_lead"
          approver_name: "John Doe"
          role: "Tech Lead"
          status: "approved"
          decision_at: "2025-01-11T10:30:00Z"
          comments: "Approved after reviewing validation results"
        - approver_id: "user:product_manager"
          approver_name: "Jane Smith"
          role: "Product Manager"
          status: "approved"
          decision_at: "2025-01-11T10:45:00Z"
          comments: "Approved for production deployment"
      approval_policy:
        required_approvals: 2
        approval_type: "all"
        timeout_hours: 48
      metadata:
        created_at: "2025-01-11T10:00:00Z"
        requested_by: "user:ml_engineer"
        expires_at: "2025-01-13T10:00:00Z"
        completed_at: "2025-01-11T11:00:00Z"

usage_guidelines:
  - "Require multiple approvals for production"
  - "Set appropriate timeout periods"
  - "Document approval conditions"
  - "Track approval history"