# Promotion Plan Artifact Schema
# Defines the structure for artifact promotion plans

version: "1.0.0"
semantic_role: "promotion_plan"
artifact_type: "schema"
semantic_root: true

metadata:
  name: "promotion-plan"
  description: "Schema for artifact promotion plans with approval workflows and deployment strategies"
  author: "MCP Core Team"
  created: "2025-01-11"
  updated: "2025-01-11"
  tags:
    - "promotion"
    - "deployment"
    - "lifecycle"
    - "approval"

schema:
  type: "object"
  required:
    - "plan_id"
    - "artifact_id"
    - "source_environment"
    - "target_environment"
    - "strategy"
    - "metadata"
  properties:
    plan_id:
      type: "string"
      description: "Unique identifier for the promotion plan"
      pattern: "^plan:[a-zA-Z0-9_-]+:[0-9]+$"
      example: "plan:promotion:20250111_100000"
      
    artifact_id:
      type: "string"
      description: "ID of artifact to promote"
      example: "artifact:model:v1.0"
      
    source_environment:
      type: "string"
      description: "Source environment"
      enum: ["development", "staging", "production"]
      example: "staging"
      
    target_environment:
      type: "string"
      description: "Target environment"
      enum: ["development", "staging", "production"]
      example: "production"
      
    strategy:
      type: "object"
      description: "Promotion strategy"
      required:
        - "type"
      properties:
        type:
          type: "string"
          enum: ["direct", "canary", "blue_green", "rolling"]
          example: "canary"
        canary_config:
          type: "object"
          properties:
            initial_percentage:
              type: "integer"
              minimum: 0
              maximum: 100
              example: 10
            increment_percentage:
              type: "integer"
              example: 10
            evaluation_period_minutes:
              type: "integer"
              example: 30
        rollback_config:
          type: "object"
          properties:
            automatic:
              type: "boolean"
              example: true
            threshold_error_rate:
              type: "number"
              example: 0.05
              
    approval:
      type: "object"
      description: "Approval requirements"
      properties:
        required:
          type: "boolean"
          example: true
        approvers:
          type: "array"
          items:
            type: "string"
          example: ["user:tech_lead", "user:product_manager"]
        approval_status:
          type: "string"
          enum: ["pending", "approved", "rejected"]
          example: "pending"
          
    validation:
      type: "object"
      description: "Pre-promotion validation"
      properties:
        required_checks:
          type: "array"
          items:
            type: "string"
          example: ["schema_validation", "quality_checks", "security_scan"]
        validation_status:
          type: "string"
          enum: ["pending", "passed", "failed"]
          example: "passed"
          
    metadata:
      type: "object"
      required:
        - "created_at"
        - "created_by"
      properties:
        created_at:
          type: "string"
          format: "date-time"
          example: "2025-01-11T10:00:00Z"
        created_by:
          type: "string"
          example: "user:ml_engineer"
        scheduled_at:
          type: "string"
          format: "date-time"
          example: "2025-01-11T14:00:00Z"

validation_rules:
  - rule: "plan_id_format"
    description: "Plan ID must follow naming convention"
    expression: "plan_id matches pattern 'plan:type:timestamp'"
    
  - rule: "different_environments"
    description: "Source and target environments must be different"
    expression: "source_environment != target_environment"

examples:
  - name: "canary_promotion_plan"
    description: "Canary deployment promotion plan"
    data:
      plan_id: "plan:promotion:20250111_100000"
      artifact_id: "artifact:model:v1.0"
      source_environment: "staging"
      target_environment: "production"
      strategy:
        type: "canary"
        canary_config:
          initial_percentage: 10
          increment_percentage: 10
          evaluation_period_minutes: 30
        rollback_config:
          automatic: true
          threshold_error_rate: 0.05
      approval:
        required: true
        approvers: ["user:tech_lead", "user:product_manager"]
        approval_status: "approved"
      validation:
        required_checks: ["schema_validation", "quality_checks", "security_scan"]
        validation_status: "passed"
      metadata:
        created_at: "2025-01-11T10:00:00Z"
        created_by: "user:ml_engineer"
        scheduled_at: "2025-01-11T14:00:00Z"

usage_guidelines:
  - "Require approval for production promotions"
  - "Use canary deployments for critical artifacts"
  - "Validate artifacts before promotion"
  - "Configure automatic rollback for safety"