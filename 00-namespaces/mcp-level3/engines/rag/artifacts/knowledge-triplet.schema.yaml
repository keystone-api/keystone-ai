# Knowledge Triplet Artifact Schema
# Defines the structure for knowledge graph triplets in RAG systems

version: "1.0.0"
semantic_role: "knowledge_triplet"
artifact_type: "schema"
semantic_root: true

metadata:
  name: "knowledge-triplet"
  description: "Schema for knowledge graph triplets representing entity-relationship-entity structures"
  author: "MCP Core Team"
  created: "2025-01-11"
  updated: "2025-01-11"
  tags:
    - "rag"
    - "knowledge-graph"
    - "triplet"
    - "semantic"

schema:
  type: "object"
  required:
    - "triplet_id"
    - "subject"
    - "predicate"
    - "object"
    - "metadata"
  properties:
    triplet_id:
      type: "string"
      description: "Unique identifier for the triplet"
      pattern: "^triplet:[a-zA-Z0-9_-]+:[0-9]+$"
      example: "triplet:doc123:001"
      
    subject:
      type: "object"
      description: "Subject entity of the triplet"
      required:
        - "entity_id"
        - "entity_type"
        - "label"
      properties:
        entity_id:
          type: "string"
          description: "Unique identifier for the entity"
          example: "entity:person:john_doe"
          
        entity_type:
          type: "string"
          description: "Type/class of the entity"
          example: "Person"
          
        label:
          type: "string"
          description: "Human-readable label"
          example: "John Doe"
          
        properties:
          type: "object"
          description: "Additional entity properties"
          additionalProperties: true
          example:
            age: 30
            occupation: "Engineer"
            
    predicate:
      type: "object"
      description: "Relationship/predicate connecting subject and object"
      required:
        - "relation_id"
        - "relation_type"
        - "label"
      properties:
        relation_id:
          type: "string"
          description: "Unique identifier for the relation"
          example: "relation:works_at"
          
        relation_type:
          type: "string"
          description: "Type of relationship"
          example: "WORKS_AT"
          
        label:
          type: "string"
          description: "Human-readable label"
          example: "works at"
          
        properties:
          type: "object"
          description: "Additional relation properties"
          additionalProperties: true
          example:
            since: "2020-01-01"
            role: "Senior Engineer"
            
    object:
      type: "object"
      description: "Object entity of the triplet"
      required:
        - "entity_id"
        - "entity_type"
        - "label"
      properties:
        entity_id:
          type: "string"
          description: "Unique identifier for the entity"
          example: "entity:organization:acme_corp"
          
        entity_type:
          type: "string"
          description: "Type/class of the entity"
          example: "Organization"
          
        label:
          type: "string"
          description: "Human-readable label"
          example: "ACME Corporation"
          
        properties:
          type: "object"
          description: "Additional entity properties"
          additionalProperties: true
          example:
            industry: "Technology"
            founded: 1990
            
    metadata:
      type: "object"
      required:
        - "source"
        - "timestamp"
        - "confidence"
      properties:
        source:
          type: "string"
          description: "Source document or extraction method"
          example: "doc123"
          
        timestamp:
          type: "string"
          format: "date-time"
          description: "Creation timestamp"
          example: "2025-01-11T10:30:00Z"
          
        confidence:
          type: "number"
          description: "Confidence score of the extraction (0-1)"
          minimum: 0
          maximum: 1
          example: 0.95
          
        extraction_method:
          type: "string"
          description: "Method used for triplet extraction"
          enum: ["manual", "rule-based", "ml-model", "llm"]
          example: "llm"
          
        model_name:
          type: "string"
          description: "Name of the extraction model"
          example: "gpt-4"
          
        context:
          type: "string"
          description: "Original text context"
          example: "John Doe works at ACME Corporation as a Senior Engineer."
          
        language:
          type: "string"
          description: "Language of the source"
          pattern: "^[a-z]{2}$"
          example: "en"
          
    semantic_context:
      type: "object"
      description: "Additional semantic context"
      properties:
        domain:
          type: "string"
          description: "Domain or topic area"
          example: "employment"
          
        ontology:
          type: "string"
          description: "Ontology reference"
          example: "schema.org"
          
        namespace:
          type: "string"
          description: "Namespace for entity/relation types"
          example: "http://schema.org/"
          
    provenance:
      type: "object"
      description: "Provenance information"
      properties:
        document_id:
          type: "string"
          example: "doc123"
          
        chunk_id:
          type: "string"
          example: "chunk:doc123:001"
          
        sentence_index:
          type: "integer"
          minimum: 0
          example: 5
          
        char_offset:
          type: "object"
          properties:
            start:
              type: "integer"
              minimum: 0
            end:
              type: "integer"
              minimum: 0
          example:
            start: 120
            end: 180
            
    validation_status:
      type: "object"
      description: "Validation and verification status"
      properties:
        validated:
          type: "boolean"
          default: false
          example: true
          
        validated_by:
          type: "string"
          example: "human_reviewer"
          
        validated_at:
          type: "string"
          format: "date-time"
          example: "2025-01-11T11:00:00Z"
          
        validation_notes:
          type: "string"
          example: "Verified against company records"

validation_rules:
  - rule: "triplet_id_format"
    description: "Triplet ID must follow naming convention"
    expression: "triplet_id matches pattern 'triplet:source:index'"
    
  - rule: "confidence_range"
    description: "Confidence must be between 0 and 1"
    expression: "metadata.confidence >= 0 && metadata.confidence <= 1"
    
  - rule: "entity_ids_unique"
    description: "Subject and object entity IDs should be different for non-reflexive relations"
    expression: "subject.entity_id != object.entity_id OR predicate.relation_type in ['IS', 'EQUALS']"
    
  - rule: "timestamp_valid"
    description: "Timestamp must be valid ISO 8601 format"
    expression: "metadata.timestamp is valid ISO 8601"

examples:
  - name: "basic_employment_triplet"
    description: "Basic employment relationship triplet"
    data:
      triplet_id: "triplet:doc123:001"
      subject:
        entity_id: "entity:person:john_doe"
        entity_type: "Person"
        label: "John Doe"
      predicate:
        relation_id: "relation:works_at"
        relation_type: "WORKS_AT"
        label: "works at"
      object:
        entity_id: "entity:organization:acme_corp"
        entity_type: "Organization"
        label: "ACME Corporation"
      metadata:
        source: "doc123"
        timestamp: "2025-01-11T10:30:00Z"
        confidence: 0.95
        extraction_method: "llm"
        model_name: "gpt-4"
        context: "John Doe works at ACME Corporation as a Senior Engineer."
        language: "en"
        
  - name: "enriched_knowledge_triplet"
    description: "Enriched triplet with full semantic context"
    data:
      triplet_id: "triplet:doc456:002"
      subject:
        entity_id: "entity:person:jane_smith"
        entity_type: "Person"
        label: "Jane Smith"
        properties:
          age: 35
          education: "PhD in Computer Science"
      predicate:
        relation_id: "relation:founded"
        relation_type: "FOUNDED"
        label: "founded"
        properties:
          date: "2015-03-15"
          role: "Co-founder & CEO"
      object:
        entity_id: "entity:organization:tech_startup"
        entity_type: "Organization"
        label: "Tech Startup Inc"
        properties:
          industry: "AI/ML"
          employees: 50
      metadata:
        source: "doc456"
        timestamp: "2025-01-11T11:00:00Z"
        confidence: 0.98
        extraction_method: "llm"
        model_name: "gpt-4"
        context: "Jane Smith founded Tech Startup Inc in 2015, serving as Co-founder and CEO."
        language: "en"
      semantic_context:
        domain: "entrepreneurship"
        ontology: "schema.org"
        namespace: "http://schema.org/"
      provenance:
        document_id: "doc456"
        chunk_id: "chunk:doc456:002"
        sentence_index: 3
        char_offset:
          start: 45
          end: 120
      validation_status:
        validated: true
        validated_by: "human_reviewer"
        validated_at: "2025-01-11T12:00:00Z"
        validation_notes: "Verified against company records and LinkedIn"

usage_guidelines:
  - "Use consistent entity and relation type naming conventions"
  - "Include confidence scores for all extracted triplets"
  - "Maintain provenance information for traceability"
  - "Validate high-confidence triplets through human review"
  - "Use ontology references for semantic interoperability"
  - "Store original context for verification and debugging"

performance_considerations:
  indexing:
    - "Index triplet_id for fast lookup"
    - "Index subject.entity_id and object.entity_id for entity queries"
    - "Index predicate.relation_type for relationship queries"
    - "Create composite indexes for common query patterns"
  storage:
    - "Normalize entity and relation definitions"
    - "Consider graph database for complex traversals"
  retrieval:
    - "Cache frequently accessed triplets"
    - "Use graph algorithms for multi-hop queries"
    - "Implement efficient subgraph matching"

integration_patterns:
  - pattern: "entity_resolution"
    description: "Resolve entity references across triplets"
    implementation: "Use entity_id as canonical identifier"
    
  - pattern: "relation_inference"
    description: "Infer new relations from existing triplets"
    implementation: "Apply inference rules on graph structure"
    
  - pattern: "confidence_propagation"
    description: "Propagate confidence scores through graph"
    implementation: "Use Bayesian networks or similar methods"