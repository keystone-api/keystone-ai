# Vector Chunk Artifact Schema
# Defines the structure for vector-embedded document chunks in RAG systems

version: "1.0.0"
semantic_role: "vector_chunk"
artifact_type: "schema"
semantic_root: true

metadata:
  name: "vector-chunk"
  description: "Schema for vector-embedded document chunks used in semantic retrieval"
  author: "MCP Core Team"
  created: "2025-01-11"
  updated: "2025-01-11"
  tags:
    - "rag"
    - "vector"
    - "embedding"
    - "retrieval"

schema:
  type: "object"
  required:
    - "chunk_id"
    - "content"
    - "embedding"
    - "metadata"
  properties:
    chunk_id:
      type: "string"
      description: "Unique identifier for the chunk"
      pattern: "^chunk:[a-zA-Z0-9_-]+:[0-9]+$"
      example: "chunk:doc123:001"
      
    content:
      type: "string"
      description: "The actual text content of the chunk"
      minLength: 1
      maxLength: 8192
      example: "Machine learning is a subset of artificial intelligence..."
      
    embedding:
      type: "array"
      description: "Vector embedding of the chunk content"
      items:
        type: "number"
        format: "float"
      minItems: 384
      maxItems: 4096
      example: [0.123, -0.456, 0.789, ...]
      
    metadata:
      type: "object"
      required:
        - "source"
        - "timestamp"
        - "chunk_index"
      properties:
        source:
          type: "string"
          description: "Source document identifier"
          example: "doc123"
          
        timestamp:
          type: "string"
          format: "date-time"
          description: "Creation timestamp"
          example: "2025-01-11T10:30:00Z"
          
        chunk_index:
          type: "integer"
          description: "Position of chunk in source document"
          minimum: 0
          example: 1
          
        chunk_size:
          type: "integer"
          description: "Size of chunk in characters"
          minimum: 1
          example: 512
          
        overlap:
          type: "integer"
          description: "Overlap with adjacent chunks in characters"
          minimum: 0
          default: 50
          example: 50
          
        language:
          type: "string"
          description: "Language of the content"
          pattern: "^[a-z]{2}$"
          example: "en"
          
        embedding_model:
          type: "string"
          description: "Model used for embedding generation"
          example: "text-embedding-ada-002"
          
        embedding_dimension:
          type: "integer"
          description: "Dimension of the embedding vector"
          minimum: 384
          maximum: 4096
          example: 1536
          
    semantic_tags:
      type: "array"
      description: "Semantic tags for classification"
      items:
        type: "string"
      example: ["machine-learning", "ai", "technical"]
      
    relevance_score:
      type: "number"
      description: "Relevance score for retrieval (0-1)"
      minimum: 0
      maximum: 1
      example: 0.85
      
    parent_document:
      type: "object"
      description: "Reference to parent document"
      properties:
        document_id:
          type: "string"
          example: "doc123"
        title:
          type: "string"
          example: "Introduction to Machine Learning"
        url:
          type: "string"
          format: "uri"
          example: "https://example.com/ml-intro"

validation_rules:
  - rule: "embedding_dimension_match"
    description: "Embedding dimension must match metadata.embedding_dimension"
    expression: "length(embedding) == metadata.embedding_dimension"
    
  - rule: "chunk_id_format"
    description: "Chunk ID must follow naming convention"
    expression: "chunk_id matches pattern 'chunk:source:index'"
    
  - rule: "content_not_empty"
    description: "Content must not be empty or whitespace only"
    expression: "trim(content).length > 0"
    
  - rule: "timestamp_valid"
    description: "Timestamp must be valid ISO 8601 format"
    expression: "metadata.timestamp is valid ISO 8601"

examples:
  - name: "basic_vector_chunk"
    description: "Basic vector chunk with minimal fields"
    data:
      chunk_id: "chunk:doc123:001"
      content: "Machine learning is a subset of artificial intelligence that focuses on building systems that learn from data."
      embedding: [0.123, -0.456, 0.789, 0.234, -0.567, 0.890]
      metadata:
        source: "doc123"
        timestamp: "2025-01-11T10:30:00Z"
        chunk_index: 1
        chunk_size: 128
        overlap: 50
        language: "en"
        embedding_model: "text-embedding-ada-002"
        embedding_dimension: 6
        
  - name: "enriched_vector_chunk"
    description: "Vector chunk with semantic tags and parent reference"
    data:
      chunk_id: "chunk:doc456:002"
      content: "Deep learning neural networks consist of multiple layers that progressively extract higher-level features from raw input."
      embedding: [0.234, -0.567, 0.890, 0.345, -0.678, 0.901]
      metadata:
        source: "doc456"
        timestamp: "2025-01-11T11:00:00Z"
        chunk_index: 2
        chunk_size: 156
        overlap: 50
        language: "en"
        embedding_model: "text-embedding-ada-002"
        embedding_dimension: 6
      semantic_tags: ["deep-learning", "neural-networks", "ai"]
      relevance_score: 0.92
      parent_document:
        document_id: "doc456"
        title: "Deep Learning Fundamentals"
        url: "https://example.com/deep-learning"

usage_guidelines:
  - "Use consistent embedding models across all chunks in a collection"
  - "Maintain overlap between adjacent chunks for context preservation"
  - "Include semantic tags for improved retrieval and classification"
  - "Store parent document references for traceability"
  - "Validate embedding dimensions before storage"
  - "Use ISO 8601 format for all timestamps"

performance_considerations:
  indexing:
    - "Index chunk_id for fast lookup"
    - "Index metadata.source for document-level queries"
    - "Use vector index (HNSW, IVF) for embedding similarity search"
  storage:
    - "Compress embeddings for storage efficiency"
    - "Consider sharding by source or timestamp"
  retrieval:
    - "Cache frequently accessed chunks"
    - "Use approximate nearest neighbor search for large collections"