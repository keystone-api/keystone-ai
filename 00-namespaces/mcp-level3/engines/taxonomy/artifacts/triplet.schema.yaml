# MCP Level 3 - Taxonomy Engine: Triplet Schema
# Purpose: Define subject-predicate-object knowledge triplets for semantic relationships
# Version: 1.0.0
# Last Updated: 2025-01-11

schema:
  name: triplet
  version: "1.0.0"
  namespace: mcp.level3.taxonomy.artifacts
  description: |
    Knowledge triplet artifact representing semantic relationships in subject-predicate-object format.
    Supports RDF-style triples, property graphs, and knowledge graph construction.
    Enables semantic reasoning, relationship traversal, and knowledge discovery.

  type: object
  required:
    - triplet_id
    - subject
    - predicate
    - object
    - created_at
  
  properties:
    # Core Identity
    triplet_id:
      type: string
      format: uuid
      description: Unique identifier for the triplet
      example: "550e8400-e29b-41d4-a716-446655440000"
      index: true
    
    # Subject (Entity)
    subject:
      type: object
      description: The subject entity of the triplet
      required:
        - id
        - type
      properties:
        id:
          type: string
          description: Subject identifier (URI or UUID)
          example: "entity:artifact-123"
          index: true
        
        type:
          type: string
          description: Subject type/class
          example: "Artifact"
          index: true
        
        label:
          type: string
          description: Human-readable label
          example: "Vector Embedding Model v2.1"
          optional: true
        
        uri:
          type: string
          format: uri
          description: Full URI of the subject
          example: "http://example.com/entities/artifact-123"
          optional: true
        
        namespace:
          type: string
          description: Namespace of the subject
          example: "mcp.artifacts"
          optional: true
        
        attributes:
          type: object
          description: Additional subject attributes
          additionalProperties: true
          optional: true
          example:
            version: "2.1.0"
            status: "active"
    
    # Predicate (Relationship)
    predicate:
      type: object
      description: The relationship/property connecting subject and object
      required:
        - id
        - type
      properties:
        id:
          type: string
          description: Predicate identifier
          example: "dependsOn"
          index: true
        
        type:
          type: string
          enum:
            - object_property
            - data_property
            - annotation_property
            - custom
          description: Predicate type
          example: "object_property"
        
        label:
          type: string
          description: Human-readable label
          example: "depends on"
          optional: true
        
        uri:
          type: string
          format: uri
          description: Full URI of the predicate
          example: "http://example.com/predicates/dependsOn"
          optional: true
        
        namespace:
          type: string
          description: Namespace of the predicate
          example: "mcp.relationships"
          optional: true
        
        inverse:
          type: string
          description: Inverse predicate ID
          example: "isDependencyOf"
          optional: true
        
        characteristics:
          type: array
          description: Predicate characteristics
          items:
            type: string
            enum:
              - transitive
              - symmetric
              - asymmetric
              - reflexive
              - irreflexive
              - functional
              - inverse_functional
          example:
            - "transitive"
          optional: true
        
        domain:
          type: array
          description: Valid subject types
          items:
            type: string
          example:
            - "Artifact"
            - "Component"
          optional: true
        
        range:
          type: array
          description: Valid object types
          items:
            type: string
          example:
            - "Artifact"
            - "Library"
          optional: true
    
    # Object (Value or Entity)
    object:
      type: object
      description: The object entity or value of the triplet
      required:
        - value
        - value_type
      properties:
        value:
          description: Object value (entity ID or literal value)
          example: "entity:library-456"
        
        value_type:
          type: string
          enum:
            - entity
            - string
            - integer
            - float
            - boolean
            - date
            - datetime
            - uri
            - json
            - array
          description: Type of the object value
          example: "entity"
        
        type:
          type: string
          description: Object entity type (if value_type is entity)
          example: "Library"
          optional: true
        
        label:
          type: string
          description: Human-readable label
          example: "NumPy Library v1.24"
          optional: true
        
        uri:
          type: string
          format: uri
          description: Full URI of the object
          example: "http://example.com/entities/library-456"
          optional: true
        
        namespace:
          type: string
          description: Namespace of the object
          example: "mcp.libraries"
          optional: true
        
        datatype:
          type: string
          description: Datatype for literal values
          example: "xsd:string"
          optional: true
        
        language:
          type: string
          pattern: '^[a-z]{2}(-[A-Z]{2})?$'
          description: Language tag for string literals
          example: "en-US"
          optional: true
        
        attributes:
          type: object
          description: Additional object attributes
          additionalProperties: true
          optional: true
    
    # Provenance
    provenance:
      type: object
      description: Provenance information for the triplet
      optional: true
      properties:
        source:
          type: string
          description: Source of the triplet
          example: "dependency-analyzer-v2.1"
        
        method:
          type: string
          enum:
            - manual
            - automated
            - inferred
            - imported
            - learned
          description: How the triplet was created
          example: "automated"
        
        confidence:
          type: number
          minimum: 0.0
          maximum: 1.0
          description: Confidence score (0-1)
          example: 0.95
        
        evidence:
          type: array
          description: Supporting evidence
          items:
            type: object
            properties:
              type:
                type: string
                description: Evidence type
              source:
                type: string
                description: Evidence source
              value:
                description: Evidence value
          optional: true
        
        created_by:
          type: string
          description: Who/what created the triplet
          example: "system:dependency-analyzer"
        
        derived_from:
          type: array
          description: Source triplets this was derived from
          items:
            type: string
            format: uuid
          optional: true
    
    # Context
    context:
      type: object
      description: Contextual information
      optional: true
      properties:
        graph_id:
          type: string
          format: uuid
          description: Knowledge graph this triplet belongs to
          example: "770e8400-e29b-41d4-a716-446655440001"
        
        namespace:
          type: string
          description: Context namespace
          example: "mcp.production"
        
        valid_from:
          type: string
          format: date-time
          description: Temporal validity start
          example: "2025-01-01T00:00:00Z"
          optional: true
        
        valid_to:
          type: string
          format: date-time
          description: Temporal validity end
          example: "2025-12-31T23:59:59Z"
          optional: true
        
        environment:
          type: string
          enum:
            - development
            - staging
            - production
            - all
          description: Environment context
          example: "production"
        
        tags:
          type: array
          items:
            type: string
          description: Context tags
          example:
            - "dependency"
            - "critical"
    
    # Quality Metrics
    quality:
      type: object
      description: Quality metrics for the triplet
      optional: true
      properties:
        accuracy:
          type: number
          minimum: 0.0
          maximum: 1.0
          description: Accuracy score
          example: 0.98
        
        completeness:
          type: number
          minimum: 0.0
          maximum: 1.0
          description: Completeness score
          example: 1.0
        
        consistency:
          type: number
          minimum: 0.0
          maximum: 1.0
          description: Consistency score
          example: 0.95
        
        freshness:
          type: number
          minimum: 0.0
          maximum: 1.0
          description: Freshness score (1 = very fresh)
          example: 0.85
        
        verified:
          type: boolean
          description: Whether triplet has been verified
          example: true
          default: false
        
        verified_at:
          type: string
          format: date-time
          description: Verification timestamp
          optional: true
        
        verified_by:
          type: string
          description: Who verified the triplet
          optional: true
    
    # Status
    status:
      type: string
      enum:
        - active
        - inactive
        - deprecated
        - pending
        - deleted
      description: Triplet status
      example: "active"
      default: "active"
    
    # Timestamps
    created_at:
      type: string
      format: date-time
      description: Creation timestamp
      example: "2025-01-11T10:00:00Z"
      index: true
    
    updated_at:
      type: string
      format: date-time
      description: Last update timestamp
      example: "2025-01-11T10:30:00Z"
      optional: true
    
    expires_at:
      type: string
      format: date-time
      description: Expiration timestamp
      example: "2025-12-31T23:59:59Z"
      optional: true
    
    # Metadata
    metadata:
      type: object
      description: Additional metadata
      optional: true
      properties:
        weight:
          type: number
          description: Relationship weight/strength
          example: 0.8
          minimum: 0.0
          maximum: 1.0
        
        priority:
          type: integer
          description: Priority level
          example: 5
          minimum: 1
          maximum: 10
        
        annotations:
          type: object
          description: Custom annotations
          additionalProperties: true
        
        references:
          type: array
          description: External references
          items:
            type: string
            format: uri
          example:
            - "https://docs.example.com/dependencies"
        
        custom:
          type: object
          description: Custom metadata fields
          additionalProperties: true

  # Validation Rules
  validation:
    rules:
      - name: valid_subject_type
        condition: subject.type is not empty
        message: "Subject must have a valid type"
        severity: error
      
      - name: valid_predicate
        condition: predicate.id is not empty
        message: "Predicate must have a valid ID"
        severity: error
      
      - name: valid_object_value
        condition: object.value is not empty
        message: "Object must have a valid value"
        severity: error
      
      - name: temporal_validity
        condition: context.valid_from == null || context.valid_to == null || context.valid_from < context.valid_to
        message: "valid_from must be before valid_to"
        severity: error
      
      - name: confidence_range
        condition: provenance.confidence == null || (provenance.confidence >= 0 && provenance.confidence <= 1)
        message: "Confidence must be between 0 and 1"
        severity: error
      
      - name: quality_metrics_range
        condition: all_quality_metrics_in_range()
        message: "All quality metrics must be between 0 and 1"
        severity: error

  # Indexes for Performance
  indexes:
    - fields: [triplet_id]
      unique: true
    - fields: [subject.id, predicate.id]
    - fields: [subject.id, subject.type]
    - fields: [predicate.id]
    - fields: [object.value, object.value_type]
    - fields: [status, created_at]
    - fields: [context.graph_id]

# Usage Examples
examples:
  - name: artifact_dependency
    description: Artifact dependency relationship
    data:
      triplet_id: "550e8400-e29b-41d4-a716-446655440000"
      subject:
        id: "entity:artifact-123"
        type: "Artifact"
        label: "Vector Embedding Model v2.1"
        uri: "http://example.com/entities/artifact-123"
        namespace: "mcp.artifacts"
        attributes:
          version: "2.1.0"
          status: "active"
      predicate:
        id: "dependsOn"
        type: "object_property"
        label: "depends on"
        uri: "http://example.com/predicates/dependsOn"
        namespace: "mcp.relationships"
        inverse: "isDependencyOf"
        characteristics:
          - "transitive"
        domain:
          - "Artifact"
        range:
          - "Artifact"
          - "Library"
      object:
        value: "entity:library-456"
        value_type: "entity"
        type: "Library"
        label: "NumPy Library v1.24"
        uri: "http://example.com/entities/library-456"
        namespace: "mcp.libraries"
      provenance:
        source: "dependency-analyzer-v2.1"
        method: "automated"
        confidence: 0.95
        created_by: "system:dependency-analyzer"
      context:
        graph_id: "770e8400-e29b-41d4-a716-446655440001"
        namespace: "mcp.production"
        environment: "production"
        tags:
          - "dependency"
          - "critical"
      quality:
        accuracy: 0.98
        completeness: 1.0
        consistency: 0.95
        freshness: 0.85
        verified: true
        verified_at: "2025-01-11T10:15:00Z"
        verified_by: "admin@example.com"
      status: "active"
      created_at: "2025-01-11T10:00:00Z"
      updated_at: "2025-01-11T10:30:00Z"
      metadata:
        weight: 0.8
        priority: 5
        annotations:
          criticality: "high"
          impact: "breaking"

  - name: literal_property
    description: Literal property value
    data:
      triplet_id: "660e8400-e29b-41d4-a716-446655440002"
      subject:
        id: "entity:artifact-123"
        type: "Artifact"
        label: "Vector Embedding Model v2.1"
      predicate:
        id: "hasVersion"
        type: "data_property"
        label: "has version"
        characteristics:
          - "functional"
      object:
        value: "2.1.0"
        value_type: "string"
        datatype: "xsd:string"
      provenance:
        source: "metadata-extractor"
        method: "automated"
        confidence: 1.0
        created_by: "system:metadata-extractor"
      status: "active"
      created_at: "2025-01-11T10:00:00Z"

  - name: inferred_relationship
    description: Inferred transitive relationship
    data:
      triplet_id: "770e8400-e29b-41d4-a716-446655440003"
      subject:
        id: "entity:artifact-123"
        type: "Artifact"
        label: "Vector Embedding Model v2.1"
      predicate:
        id: "dependsOn"
        type: "object_property"
        label: "depends on"
        characteristics:
          - "transitive"
      object:
        value: "entity:library-789"
        value_type: "entity"
        type: "Library"
        label: "SciPy Library v1.10"
      provenance:
        source: "reasoning-engine"
        method: "inferred"
        confidence: 0.90
        created_by: "system:reasoning-engine"
        derived_from:
          - "550e8400-e29b-41d4-a716-446655440000"
          - "880e8400-e29b-41d4-a716-446655440004"
        evidence:
          - type: "transitive_closure"
            source: "reasoning-engine"
            value: "artifact-123 -> library-456 -> library-789"
      quality:
        accuracy: 0.90
        completeness: 1.0
        consistency: 1.0
        freshness: 1.0
        verified: false
      status: "active"
      created_at: "2025-01-11T10:05:00Z"

# Integration Guidelines
integration:
  creation:
    - Validate subject, predicate, and object
    - Check domain and range constraints
    - Assign confidence scores
    - Record provenance information
    - Index for efficient querying
  
  querying:
    - Support SPARQL-like queries
    - Enable graph traversal
    - Implement pattern matching
    - Support reasoning and inference
    - Cache frequent queries
  
  reasoning:
    - Apply transitive closure
    - Infer inverse relationships
    - Check consistency
    - Detect contradictions
    - Generate derived triplets
  
  maintenance:
    - Regular quality assessment
    - Remove expired triplets
    - Update confidence scores
    - Verify critical relationships
    - Archive historical data

# Performance Considerations
performance:
  storage:
    - Use triple store or graph database
    - Index on subject, predicate, object
    - Partition by graph_id or namespace
    - Compress historical data
  
  querying:
    - Cache frequent patterns
    - Use materialized views for common queries
    - Implement query optimization
    - Support parallel query execution
  
  reasoning:
    - Incremental reasoning for updates
    - Cache inference results
    - Limit reasoning depth
    - Use rule-based optimization
  
  scalability:
    - Horizontal partitioning by graph
    - Distributed query processing
    - Asynchronous reasoning
    - Batch processing for bulk operations

# Best Practices
best_practices:
  modeling:
    - Use consistent naming conventions
    - Define clear predicate semantics
    - Document domain and range
    - Specify inverse relationships
    - Use standard vocabularies when possible
  
  quality:
    - Assign confidence scores
    - Record provenance
    - Verify critical relationships
    - Regular quality audits
    - Remove low-quality triplets
  
  maintenance:
    - Version control for schemas
    - Track relationship evolution
    - Archive obsolete triplets
    - Document breaking changes
    - Provide migration paths