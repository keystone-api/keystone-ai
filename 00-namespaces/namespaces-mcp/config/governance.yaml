# governance.yaml
# 治理合規配置
# 版本: 1.0.0

version: "1.0.0"
description: "MachineNativeOps 治理合規框架配置"

# 許可證管理
license:
  default_license: "MachineNativeOps Enterprise License v1.0"
  
  header_template: |
    # Copyright (c) 2024 MachineNativeOps. All rights reserved.
    # Licensed under the MachineNativeOps Enterprise License v1.0.
    # 
    # This file is part of the MachineNativeOps namespace-mcp project.
    # 
    # NOTICE: All information contained herein is, and remains the property
    # of MachineNativeOps and its suppliers, if any. The intellectual and
    # technical concepts contained herein are proprietary to MachineNativeOps
    # and its suppliers and may be covered by patents, patents in process,
    # and are protected by trade secret or copyright law.
    # 
    # Dissemination of this information or reproduction of this material
    # is strictly forbidden unless prior written permission is obtained
    # from MachineNativeOps.
  
  allowed_source_licenses:
    - name: "MIT"
      compatible: true
      requires_attribution: true
    
    - name: "Apache-2.0"
      compatible: true
      requires_attribution: true
    
    - name: "BSD-3-Clause"
      compatible: true
      requires_attribution: true
    
    - name: "ISC"
      compatible: true
      requires_attribution: true
  
  prohibited_licenses:
    - name: "GPL-3.0"
      reason: "Copyleft requirements incompatible"
    
    - name: "AGPL-3.0"
      reason: "Network copyleft incompatible"
    
    - name: "SSPL"
      reason: "Service provider restrictions"
  
  conversion_rules:
    add_header: true
    update_license_file: true
    preserve_attribution: true
    document_changes: true

# 安全合規
security:
  level: "maximum"
  
  standards:
    - name: "SLSA"
      level: "L3"
      requirements:
        - "Source integrity"
        - "Build integrity"
        - "Provenance"
        - "Hermetic builds"
    
    - name: "Zero-Trust"
      principles:
        - "Never trust, always verify"
        - "Assume breach"
        - "Verify explicitly"
        - "Use least privilege access"
    
    - name: "ISO27001"
      controls:
        - "Access control"
        - "Cryptography"
        - "Operations security"
        - "Communications security"
    
    - name: "SOC2-Type-II"
      trust_principles:
        - "Security"
        - "Availability"
        - "Processing integrity"
        - "Confidentiality"
        - "Privacy"
  
  requirements:
    code_signing:
      enabled: true
      algorithm: "RSA-4096"
      hash: "SHA3-512"
    
    vulnerability_scanning:
      enabled: true
      frequency: "continuous"
      tools:
        - "Snyk"
        - "Trivy"
        - "OWASP Dependency-Check"
    
    dependency_checking:
      enabled: true
      sbom_generation: true
      license_validation: true
      vulnerability_check: true
    
    secret_detection:
      enabled: true
      patterns:
        - "API keys"
        - "Passwords"
        - "Private keys"
        - "Tokens"
  
  encryption:
    at_rest:
      enabled: true
      algorithm: "AES-256-GCM"
    
    in_transit:
      enabled: true
      protocol: "TLS 1.3"
      min_version: "TLS 1.2"
    
    key_management:
      rotation_period: "90 days"
      storage: "HSM"

# 審計配置
audit:
  enabled: true
  level: "detailed"
  retention: "permanent"
  
  hash_algorithm: "sha3-512"
  signature_algorithm: "Ed25519"
  
  tracked_events:
    - event: "file_conversion"
      severity: "info"
      fields:
        - "source_file"
        - "target_file"
        - "changes_made"
        - "timestamp"
    
    - event: "dependency_replacement"
      severity: "info"
      fields:
        - "original_dependency"
        - "replacement_dependency"
        - "version"
        - "timestamp"
    
    - event: "structure_modification"
      severity: "warning"
      fields:
        - "original_structure"
        - "new_structure"
        - "reason"
        - "timestamp"
    
    - event: "license_update"
      severity: "critical"
      fields:
        - "original_license"
        - "new_license"
        - "file_path"
        - "timestamp"
    
    - event: "security_check"
      severity: "critical"
      fields:
        - "check_type"
        - "result"
        - "findings"
        - "timestamp"
  
  storage:
    type: "immutable"
    backend: "blockchain"
    replication: 3
    
  reporting:
    frequency: "daily"
    format: "json"
    destination: "audit-logs/"

# 合規標準
compliance:
  standards:
    - name: "GDPR"
      region: "EU"
      requirements:
        - "Data minimization"
        - "Purpose limitation"
        - "Storage limitation"
        - "Right to erasure"
      
      implementation:
        data_classification: true
        consent_management: true
        data_portability: true
        breach_notification: true
    
    - name: "CCPA"
      region: "California, USA"
      requirements:
        - "Right to know"
        - "Right to delete"
        - "Right to opt-out"
        - "Non-discrimination"
      
      implementation:
        consumer_requests: true
        opt_out_mechanism: true
        data_inventory: true
    
    - name: "HIPAA"
      region: "USA"
      requirements:
        - "Privacy Rule"
        - "Security Rule"
        - "Breach Notification Rule"
      
      implementation:
        phi_protection: true
        access_controls: true
        audit_controls: true
        encryption: true
    
    - name: "PCI-DSS"
      version: "4.0"
      requirements:
        - "Build and maintain secure network"
        - "Protect cardholder data"
        - "Maintain vulnerability management"
        - "Implement strong access control"
      
      implementation:
        network_segmentation: true
        data_encryption: true
        vulnerability_scanning: true
        access_logging: true
  
  validation:
    automated: true
    manual_review: false
    approval_required: false
    
    checks:
      - "License compatibility"
      - "Security vulnerabilities"
      - "Data privacy compliance"
      - "Audit trail completeness"

# 政策即代碼 (Policy as Code)
policies:
  - name: "dependency_approval"
    description: "所有依賴必須經過批准"
    enforcement: "strict"
    
    rules:
      - condition: "dependency.license in allowed_licenses"
        action: "approve"
      
      - condition: "dependency.license in prohibited_licenses"
        action: "reject"
      
      - condition: "dependency.vulnerabilities.critical > 0"
        action: "reject"
  
  - name: "code_quality"
    description: "代碼質量標準"
    enforcement: "warning"
    
    rules:
      - condition: "code_coverage < 80%"
        action: "warn"
      
      - condition: "complexity > 15"
        action: "warn"
      
      - condition: "duplicated_code > 5%"
        action: "warn"
  
  - name: "security_baseline"
    description: "安全基線要求"
    enforcement: "strict"
    
    rules:
      - condition: "secrets_detected"
        action: "reject"
      
      - condition: "vulnerabilities.high > 0"
        action: "reject"
      
      - condition: "insecure_dependencies"
        action: "reject"

# 護欄即代碼 (GuardRails as Code)
guardrails:
  - name: "prevent_license_violation"
    type: "pre-commit"
    
    checks:
      - "Verify license compatibility"
      - "Check for prohibited licenses"
      - "Validate license headers"
  
  - name: "enforce_naming_convention"
    type: "pre-commit"
    
    checks:
      - "Validate class names"
      - "Validate method names"
      - "Validate variable names"
  
  - name: "security_scan"
    type: "pre-merge"
    
    checks:
      - "Scan for vulnerabilities"
      - "Check for secrets"
      - "Validate dependencies"
  
  - name: "compliance_check"
    type: "pre-release"
    
    checks:
      - "Verify GDPR compliance"
      - "Verify CCPA compliance"
      - "Verify audit trail"

# 變更管理
change_management:
  approval_workflow:
    enabled: true
    
    stages:
      - name: "automated_checks"
        required: true
        checks:
          - "unit_tests"
          - "integration_tests"
          - "security_scan"
          - "license_check"
      
      - name: "peer_review"
        required: false
        reviewers: 1
      
      - name: "security_review"
        required: true
        reviewers: 1
        role: "security_team"
      
      - name: "compliance_review"
        required: true
        reviewers: 1
        role: "compliance_team"
  
  rollback_strategy:
    enabled: true
    automatic: true
    
    triggers:
      - "test_failure"
      - "security_violation"
      - "compliance_violation"
    
    retention:
      backups: 10
      duration: "90 days"

# 報告配置
reporting:
  compliance_reports:
    frequency: "monthly"
    format: "pdf"
    recipients:
      - "compliance@machinenativeops.com"
      - "security@machinenativeops.com"
    
    sections:
      - "Executive summary"
      - "Compliance status"
      - "Security findings"
      - "Audit trail"
      - "Recommendations"
  
  security_reports:
    frequency: "weekly"
    format: "json"
    recipients:
      - "security@machinenativeops.com"
    
    sections:
      - "Vulnerability summary"
      - "Dependency status"
      - "Security incidents"
      - "Remediation status"
  
  audit_reports:
    frequency: "daily"
    format: "json"
    destination: "audit-logs/"
    
    sections:
      - "Event summary"
      - "Critical events"
      - "Access logs"
      - "Change logs"

# 元數據
metadata:
  created: "2024-01-09T12:00:00Z"
  author: "MachineNativeOps Governance Team"
  version: "1.0.0"
  
  tags:
    - "governance"
    - "compliance"
    - "security"
    - "audit"
  
  references:
    - "https://slsa.dev"
    - "https://www.iso.org/standard/27001"
    - "https://www.aicpa.org/soc2"
    - "https://gdpr.eu"
    - "https://oag.ca.gov/privacy/ccpa"