# AXIOM Backup System - Plugin Configuration
# Hot-reload enabled with environment-specific overrides
version: "1.0.0"
environment: "development"

# Global plugin management settings
plugin_management:
  hot_reload: true
  watch_interval: "5s"
  validation_required: true
  rollback_on_failure: true
  max_load_time: "100ms"
  max_teardown_time: "50ms"
  
# Plugin dependency resolution
dependency_resolution:
  strategy: "TOPOLOGICAL_SORT"
  conflict_resolution: "PRIORITY_BASED"
  circular_dependency: "REJECT"
  auto_load_dependencies: true

# Individual plugin configurations
plugins:
  # ZSTD Compression Plugin
  compression_zstd:
    enabled: true
    priority: 10
    version: "1.0.0"
    dependencies: []
    config:
      compression_level: 12
      chunk_size: 4194304  # 4MB
      threads: 8
      window_log: 23
      hash_log: 23
      chain_log: 23
      search_log: 23
      min_match: 3
      target_length: 16
      write_checksum: true
      write_content_size: true
      write_dict_id: false
      max_window_size: 0
      stream_buffer_size: 1048576  # 1MB
    performance:
      memory_limit: "10MB"
      cpu_priority: "NORMAL"
      thread_safety: true
      
  # AES Encryption Plugin
  encryption_aes:
    enabled: true
    priority: 20
    version: "1.0.0"
    dependencies: []
    config:
      algorithm: "AES-256-GCM"
      key_rotation_interval: 86400  # 24 hours
      max_keys: 100
      key_derivation_iterations: 100000
      key_store_path: "keys"
      selective_patterns: [".secret", ".key", ".pem", ".p12", ".pfx"]
      exclude_patterns: [".tmp", ".cache", ".log"]
      encrypt_metadata: true
      chunk_size: 65536  # 64KB
      parallel_encryption: true
    security:
      secure_erase: true
      key_protection: "HARDWARE_BACKED"
      audit_logging: true
      
  # Incremental Backup Plugin
  backup_incremental:
    enabled: true
    priority: 30
    version: "1.0.0"
    dependencies: []
    config:
      backup_root: "backups"
      database_file: "backup_index.db"
      hash_algorithm: "sha256"
      follow_symlinks: false
      ignore_hidden: true
      exclude_patterns: [".git", ".svn", ".hg", "__pycache__", "node_modules", ".DS_Store"]
      chunk_size: 1048576  # 1MB
      parallel_processing: true
      max_workers: 4
      auto_cleanup: true
      cleanup_interval: 3600  # 1 hour
      full_backup_interval: 604800  # 7 days
      incremental_backup_interval: 3600  # 1 hour
    retention_policy:
      daily_backups: 30
      weekly_backups: 12
      monthly_backups: 24
      yearly_backups: 10
      max_total_backups: 1000
      max_storage_gb: 1000.0
    monitoring:
      enable_metrics: true
      alert_thresholds:
        backup_failure_rate: 5  # percentage
        storage_usage: 85  # percentage
        retention_violation: 1  # count
        
  # S3 Storage Backend Plugin
  storage_s3:
    enabled: false  # Requires AWS credentials
    priority: 40
    version: "1.0.0"
    dependencies: []
    config:
      bucket_name: "axiom-backup-bucket"
      region: "us-east-1"
      access_key_id: "${AWS_ACCESS_KEY_ID}"
      secret_access_key: "${AWS_SECRET_ACCESS_KEY}"
      session_token: "${AWS_SESSION_TOKEN}"
      endpoint_url: null
      use_ssl: true
      verify_ssl: true
      signature_version: "s3v4"
      addressing_style: "auto"
      max_retries: 3
      max_pool_connections: 50
      multipart_threshold: 67108864  # 64MB
      multipart_chunksize: 16777216  # 16MB
      max_concurrency: 8
      use_threads: true
      storage_class: "STANDARD"
      server_side_encryption: "AES256"
      content_type_detection: true
      default_metadata:
        backup_system: "AXIOM"
        version: "1.0.0"
        managed_by: "plugin_system"
      default_tags:
        Environment: "production"
        BackupType: "automated"
        Retention: "standard"
    performance:
      upload_optimization: true
      bandwidth_throttling: null  # bytes per second
      connection_pooling: true

# Plugin chains and workflows
workflows:
  # Complete backup workflow
  full_backup_pipeline:
    description: "Complete backup with compression, encryption, and cloud storage"
    plugins:
      - "backup_incremental"  # Create backup
      - "compression_zstd"    # Compress
      - "encryption_aes"      # Encrypt
      - "storage_s3"          # Upload to cloud
    parallel_execution: false
    error_handling: "STOP_ON_FAILURE"
    retry_policy:
      max_retries: 3
      backoff_strategy: "EXPONENTIAL"
      
  # Quick backup workflow (local only)
  quick_backup_pipeline:
    description: "Fast local backup with compression only"
    plugins:
      - "backup_incremental"  # Create backup
      - "compression_zstd"    # Compress
    parallel_execution: false
    error_handling: "CONTINUE_ON_FAILURE"
    retry_policy:
      max_retries: 1
      backoff_strategy: "LINEAR"
      
  # Archive workflow (compression + encryption)
  archive_pipeline:
    description: "Create encrypted archive for long-term storage"
    plugins:
      - "compression_zstd"    # Compress
      - "encryption_aes"      # Encrypt
    parallel_execution: false
    error_handling: "STOP_ON_FAILURE"
    retry_policy:
      max_retries: 2
      backoff_strategy: "EXPONENTIAL"

# Hot-reload configuration
hot_reload:
  enabled: true
  watch_directories:
    - "config"
    - "plugins"
  file_patterns:
    - "*.yaml"
    - "*.yml"
    - "*.json"
    - "*.py"
  ignore_patterns:
    - "*.pyc"
    - "__pycache__"
    - ".git"
  validation_hooks:
    - "validate_plugin_config"
    - "check_dependencies"
    - "verify_permissions"
  reload_triggers:
    - "file_modified"
    - "file_created"
    - "file_deleted"

# Environment-specific overrides will be loaded from:
# - config/plugins_config.production.yaml
# - config/production/plugins_config.yaml
# - Environment variables: AXIOM_CONFIG_<PLUGIN>_<SETTING>

# Monitoring and metrics
monitoring:
  enabled: true
  metrics_collection_interval: "30s"
  health_check_interval: "60s"
  performance_profiling: true
  log_level: "INFO"
  alerts:
    plugin_failure:
      enabled: true
      threshold: 1  # consecutive failures
      cooldown: "5m"
    performance_degradation:
      enabled: true
      threshold: 50  # percentage increase
      metric: "execution_time"
    memory_usage:
      enabled: true
      threshold: 90  # percentage
      action: "restart_plugin"

# Security settings
security:
  plugin_isolation: true
  sandbox_mode: false
  require_signatures: false
  audit_trail: true
  permission_validation: true
  secure_config_storage: true

# Development settings
development:
  debug_mode: false
  verbose_logging: false
  mock_external_services: false
  enable_test_plugins: false
  performance_profiling: true