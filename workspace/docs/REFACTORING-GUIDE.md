# MachineNativeOps é‡æ§‹åŸ·è¡ŒæŒ‡å—

## æ¦‚è¿°

æœ¬æ–‡æª”æä¾›äº† MachineNativeOps å°ˆæ¡ˆæ¶æ§‹é‡æ§‹çš„è©³ç´°åŸ·è¡ŒæŒ‡å—ã€‚è«‹å‹™å¿…åœ¨åŸ·è¡Œå‰é–±è®€å®Œæ•´çš„æ¶æ§‹è¨­è¨ˆæ–‡æª”ã€‚

## å‰ç½®æº–å‚™

### 1. æª¢æŸ¥ç’°å¢ƒ

```bash
# ç¢ºèªç•¶å‰åˆ†æ”¯
git branch

# ç¢ºèªå·¥ä½œç›®éŒ„ä¹¾æ·¨
git status

# ç¢ºèªæœ‰å¿…è¦çš„å·¥å…·
which python3
which node
which git
```

### 2. é–±è®€æ–‡æª”

- å®Œæ•´æ¶æ§‹è¨­è¨ˆï¼š`workspace/docs/ARCHITECTURE-REFACTORING-DESIGN.md`
- æœ¬åŸ·è¡ŒæŒ‡å—

### 3. å‚™ä»½ç¢ºèª

è…³æœ¬æœƒè‡ªå‹•å‰µå»ºå‚™ä»½ï¼Œä½†å»ºè­°æ‰‹å‹•ç¢ºèªï¼š

```bash
# å‰µå»ºæ‰‹å‹•å‚™ä»½æ¨™ç±¤
git tag -a "manual-backup-$(date +%Y%m%d)" -m "Manual backup before refactoring"
git push origin manual-backup-$(date +%Y%m%d)
```

## åŸ·è¡Œæ­¥é©Ÿ

### é¸é … Aï¼šå®Œå…¨è‡ªå‹•åŒ–ï¼ˆæ¨è–¦ï¼‰

```bash
# åŸ·è¡Œæ‰€æœ‰éšæ®µï¼ˆäº¤äº’å¼ï¼‰
./scripts/safe-refactor.sh all
```

è…³æœ¬æœƒï¼š
1. è‡ªå‹•å‰µå»ºå‚™ä»½
2. åŸ·è¡Œ Phase 1ï¼ˆä½é¢¨éšªæ¸…ç†ï¼‰
3. é‹è¡Œé©—è­‰
4. è©¢å•æ˜¯å¦ç¹¼çºŒ
5. åŸ·è¡Œ Phase 2ï¼ˆè§£æ±ºé‡è¤‡ï¼‰
6. é‹è¡Œé©—è­‰
7. è©¢å•æ˜¯å¦ç¹¼çºŒ
8. åŸ·è¡Œ Phase 3ï¼ˆæ•´ç†æ•£è½æª”æ¡ˆï¼‰
9. é‹è¡Œæœ€çµ‚é©—è­‰

### é¸é … Bï¼šé€æ­¥åŸ·è¡Œ

#### Phase 1ï¼šä½é¢¨éšªæ¸…ç†

```bash
# åŸ·è¡Œ Phase 1
./scripts/safe-refactor.sh phase1
```

**é€™å€‹éšæ®µæœƒï¼š**
- é‡å‘½åä¸­æ–‡ç›®éŒ„ `ä»£ç¢¼è–æ®¿` â†’ `sacred-modules`
- æ¸…ç†æ§‹å»ºç”¢ç‰© `.egg-info`
- é‡å‘½å `_scratch` â†’ `_sandbox`

**é©—è­‰ï¼š**
```bash
# æª¢æŸ¥ç„¡ä¸­æ–‡ç›®éŒ„
find workspace/src/ -maxdepth 1 -type d -name "*[ä¸€-é¾¥]*"

# æª¢æŸ¥ç„¡æ§‹å»ºç”¢ç‰©
find workspace/src/ -name "*.egg-info"

# æª¢æŸ¥æ–°ç›®éŒ„å­˜åœ¨
ls -la workspace/src/sacred-modules/
ls -la workspace/src/_sandbox/
```

#### Phase 2ï¼šè§£æ±ºé‡è¤‡

```bash
# åŸ·è¡Œ Phase 2
./scripts/safe-refactor.sh phase2
```

**é€™å€‹éšæ®µæœƒï¼š**
- åˆä½µ `core/contracts/` â†’ `contracts/`
- æ•´åˆ `core/contract_service/` â†’ `services/contract-service/`
- æ•´åˆ `web/` â†’ `apps/web/`

**é©—è­‰ï¼š**
```bash
# æª¢æŸ¥æœå‹™çµæ§‹
ls -la workspace/src/services/

# æª¢æŸ¥æ‡‰ç”¨çµæ§‹
ls -la workspace/src/apps/

# æª¢æŸ¥ç„¡é‡è¤‡ç›®éŒ„
[ ! -d "workspace/src/core/contracts" ]
[ ! -d "workspace/src/core/contract_service" ]
[ ! -d "workspace/src/web" ]
```

**âš ï¸ é‡è¦ï¼š** Phase 2 å®Œæˆå¾Œï¼Œéœ€è¦æ‰‹å‹•æ›´æ–°ä»¥ä¸‹é…ç½®ï¼š
- `package.json` ä¸­çš„ workspaces é…ç½®
- æœå‹™ç™¼ç¾é…ç½®
- æ§‹å»ºè…³æœ¬
- éƒ¨ç½²é…ç½®

#### Phase 3ï¼šæ•´ç†æ•£è½æª”æ¡ˆ

```bash
# åŸ·è¡Œ Phase 3
./scripts/safe-refactor.sh phase3
```

**é€™å€‹éšæ®µæœƒï¼š**
- æ•´ç†æ ¸å¿ƒ Python æª”æ¡ˆåˆ°å­ç›®éŒ„
- å‰µå»º `ai_engine/`, `automation/`, `engine/` å­ç›®éŒ„
- ç§»å‹•ç›¸é—œæª”æ¡ˆ

**é©—è­‰ï¼š**
```bash
# æª¢æŸ¥æ–°ç›®éŒ„çµæ§‹
ls -la workspace/src/core/ai_engine/
ls -la workspace/src/core/automation/
ls -la workspace/src/core/engine/

# é‹è¡Œ Python æ¸¬è©¦
pytest workspace/src/core/
```

**âš ï¸ é‡è¦ï¼š** Phase 3 å®Œæˆå¾Œï¼Œéœ€è¦æ‰‹å‹•æ›´æ–° Python å°å…¥è·¯å¾‘ï¼š
- æ›´æ–°æ‰€æœ‰ `from core.xxx import` èªå¥
- æ›´æ–°ç›¸é—œæ¸¬è©¦æª”æ¡ˆ
- æ›´æ–°æ–‡æª”ä¸­çš„ç¯„ä¾‹ä»£ç¢¼

## é©—è­‰

### é‹è¡Œçµæ§‹é©—è­‰

```bash
./scripts/validate-structure.sh
```

### é‹è¡Œå®Œæ•´æ¸¬è©¦å¥—ä»¶

```bash
# Node.js æ¸¬è©¦
npm test

# Python æ¸¬è©¦
pytest

# æ§‹å»º
npm run build
```

### æª¢æŸ¥å‚™ä»½

```bash
# æŸ¥çœ‹å‚™ä»½ç›®éŒ„
cat .last-backup
ls -la $(cat .last-backup)

# æŸ¥çœ‹å‚™ä»½æ¨™ç±¤
git tag -l "pre-refactor-*"
```

## å›æ»¾

å¦‚æœé‡åˆ°å•é¡Œï¼Œå¯ä»¥éš¨æ™‚å›æ»¾ï¼š

```bash
# è‡ªå‹•å›æ»¾
./scripts/rollback.sh
```

å›æ»¾è…³æœ¬æœƒï¼š
1. æŸ¥æ‰¾æœ€æ–°çš„å‚™ä»½æ¨™ç±¤
2. åŸ·è¡Œ Git reset
3. æ¢å¾©æ–‡ä»¶ç³»çµ±å‚™ä»½ï¼ˆå¦‚æœå­˜åœ¨ï¼‰

### æ‰‹å‹•å›æ»¾æ­¥é©Ÿ

```bash
# 1. æ‰¾åˆ°å‚™ä»½æ¨™ç±¤
git tag -l "pre-refactor-*"

# 2. é‡ç½®åˆ°å‚™ä»½æ¨™ç±¤
git reset --hard pre-refactor-YYYYMMDD_HHMMSS

# 3. å¦‚æœéœ€è¦ï¼Œæ¢å¾©æ–‡ä»¶ç³»çµ±å‚™ä»½
BACKUP_DIR=$(cat .last-backup)
cp -r $BACKUP_DIR/* workspace/src/

# 4. é©—è­‰å›æ»¾
git status
./scripts/validate-structure.sh
```

## åŸ·è¡Œå¾Œæ¸…ç†

### 1. æ¸¬è©¦é©—è­‰

```bash
# é‹è¡Œæ‰€æœ‰æ¸¬è©¦
npm test
pytest

# æ§‹å»ºæ‡‰ç”¨
npm run build

# æœ¬åœ°é‹è¡Œæ‡‰ç”¨
npm run dev
```

### 2. æ›´æ–°æ–‡æª”

```bash
# æ›´æ–° README.md ä¸­çš„ç›®éŒ„çµæ§‹
# æ›´æ–°æ¶æ§‹æ–‡æª”
# æ›´æ–° API æ–‡æª”
```

### 3. æäº¤æ›´æ”¹

```bash
# æ·»åŠ æ›´æ”¹
git add .

# æäº¤
git commit -m "refactor: å®Œæˆæ¶æ§‹é‡æ§‹

- é‡å‘½åä¸­æ–‡ç›®éŒ„ç‚ºè‹±æ–‡
- æ¸…ç†æ§‹å»ºç”¢ç‰©
- åˆä½µé‡è¤‡ç›®éŒ„
- æ•´ç†æ ¸å¿ƒæ¨¡çµ„çµæ§‹
- æ›´æ–°é©—è­‰è…³æœ¬

è©³è¦‹: workspace/docs/ARCHITECTURE-REFACTORING-DESIGN.md"

# æ¨é€
git push origin <your-branch>
```

### 4. å‰µå»º Pull Request

```bash
# ä½¿ç”¨ GitHub CLI
gh pr create \
  --title "feat: æ¶æ§‹é‡æ§‹ - å„ªåŒ–ç›®éŒ„çµæ§‹" \
  --body "å®Œæˆæ¶æ§‹é‡æ§‹ï¼Œè©³è¦‹è¨­è¨ˆæ–‡æª”" \
  --base main \
  --head <your-branch>
```

## å¸¸è¦‹å•é¡Œ

### Q1: è…³æœ¬åŸ·è¡Œå¤±æ•—æ€éº¼è¾¦ï¼Ÿ

**A:**
1. æŸ¥çœ‹éŒ¯èª¤è¨Šæ¯
2. æª¢æŸ¥å‚™ä»½æ˜¯å¦å‰µå»ºæˆåŠŸ
3. å¦‚æœç„¡æ³•ä¿®å¾©ï¼Œç«‹å³å›æ»¾
4. å ±å‘Šå•é¡Œä¸¦ç­‰å¾…ä¿®å¾©

### Q2: Phase 2 å¾Œæ¸¬è©¦å¤±æ•—ï¼Ÿ

**A:**
1. æª¢æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¢ºæ›´æ–°
2. æª¢æŸ¥å°å…¥è·¯å¾‘æ˜¯å¦æ­£ç¢º
3. é‹è¡Œ `./scripts/validate-structure.sh`
4. å¦‚æœç„¡æ³•ä¿®å¾©ï¼Œå›æ»¾åˆ° Phase 1 å®Œæˆç‹€æ…‹

### Q3: Phase 3 å¾Œ Python å°å…¥éŒ¯èª¤ï¼Ÿ

**A:**
1. æª¢æŸ¥å‚™ä»½ç›®éŒ„ä¸­çš„å°å…¥æ›´æ–°å»ºè­°
2. æ‰‹å‹•æ›´æ–°æ‰€æœ‰å°å…¥è·¯å¾‘
3. é‹è¡Œ `pytest workspace/src/core/`
4. é€å€‹ä¿®å¾©æ¸¬è©¦å¤±æ•—

### Q4: å›æ»¾å¾Œå¦‚ä½•ç¹¼çºŒï¼Ÿ

**A:**
1. åˆ†æå¤±æ•—åŸå› 
2. å ±å‘Šå•é¡Œ
3. ç­‰å¾…ä¿®å¾©æˆ–å°‹æ±‚æ›¿ä»£æ–¹æ¡ˆ
4. ä¸è¦åœ¨æœªä¿®å¾©çš„æƒ…æ³ä¸‹é‡æ–°åŸ·è¡Œ

## æª¢æŸ¥æ¸…å–®

### åŸ·è¡Œå‰
- [ ] å·²é–±è®€å®Œæ•´è¨­è¨ˆæ–‡æª”
- [ ] å·²å‰µå»ºæ‰‹å‹•å‚™ä»½
- [ ] å·¥ä½œç›®éŒ„ä¹¾æ·¨ï¼ˆç„¡æœªæäº¤æ›´æ”¹ï¼‰
- [ ] å·²æº–å‚™è¶³å¤ çš„æ™‚é–“ï¼ˆé è¨ˆ 5-9 å°æ™‚ï¼‰
- [ ] åœ˜éšŠæˆå“¡å·²é€šçŸ¥

### åŸ·è¡Œä¸­
- [ ] Phase 1 å®Œæˆä¸¦é©—è­‰
- [ ] Phase 2 å®Œæˆä¸¦é©—è­‰
- [ ] é…ç½®æ–‡ä»¶å·²æ›´æ–°
- [ ] Phase 3 å®Œæˆä¸¦é©—è­‰
- [ ] å°å…¥è·¯å¾‘å·²æ›´æ–°
- [ ] æ‰€æœ‰æ¸¬è©¦é€šé

### åŸ·è¡Œå¾Œ
- [ ] æ‡‰ç”¨ç¨‹å¼æ­£å¸¸é‹è¡Œ
- [ ] æ–‡æª”å·²æ›´æ–°
- [ ] æ›´æ”¹å·²æäº¤
- [ ] Pull Request å·²å‰µå»º
- [ ] åœ˜éšŠå·²é€šçŸ¥
- [ ] å‚™ä»½å·²ä¿ç•™ï¼ˆè‡³å°‘ä¸€é€±ï¼‰

## æ”¯æŒèˆ‡è¯ç¹«

å¦‚æœ‰å•é¡Œæˆ–éœ€è¦å”åŠ©ï¼š
- æŸ¥çœ‹è¨­è¨ˆæ–‡æª”ï¼š`workspace/docs/ARCHITECTURE-REFACTORING-DESIGN.md`
- å‰µå»º Issueï¼šåœ¨ GitHub ä¸Šå‰µå»º issue
- è¯ç¹«åœ˜éšŠï¼š[å¾…å¡«å¯«]

## ç‰ˆæœ¬æ­·å²

- v1.0.0 (2024-01-15): åˆå§‹ç‰ˆæœ¬

---

**ç¥é‡æ§‹é †åˆ©ï¼** ğŸ‰