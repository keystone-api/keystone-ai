%YAML 1.2
---
# ═══════════════════════════════════════════════════════════════════════════════
#                    HOLY GRAIL BOOT PLAYBOOK
#                    聖杯啟動劇本 - 傳奇團隊初始化
# ═══════════════════════════════════════════════════════════════════════════════

apiVersion: playbooks.machinenativeops/v2
kind: BootPlaybook
metadata:
  name: grail_boot
  version: "2.0.0"
  description: "Initialize the legendary Holy Grail team - 初始化傳奇聖杯團隊"

spec:
  execution_mode: "INSTANT"
  max_latency_ms: 30000

  triggers:
    - on_startup: true

  steps:
    # ═══════════════════════════════════════════════════════════════════════════
    # STEP 1: Load Core Configuration
    # ═══════════════════════════════════════════════════════════════════════════
    - id: "load_team_config"
      action: "config.load"
      description: "Load Holy Grail team configuration"
      inputs:
        path: "teams/holy-grail/team.yaml"
      outputs:
        - team_config

    - id: "load_dissolution_manifest"
      action: "mcp.manifest.load"
      description: "Load AXIOM dissolution manifest"
      parallel_with: ["load_team_config"]
      inputs:
        path: "teams/holy-grail/dissolved-assets/AXIOM_DISSOLVED_INTEGRATION_MANIFEST.yaml"
      outputs:
        - dissolution_manifest

    - id: "load_unified_pipeline"
      action: "mcp.pipeline.load"
      description: "Load unified MCP pipeline configuration"
      parallel_with: ["load_team_config"]
      inputs:
        path: "teams/holy-grail/dissolved-assets/pipelines/unified-pipeline-config.yaml"
      outputs:
        - pipeline_config

    # ═══════════════════════════════════════════════════════════════════════════
    # STEP 2: Initialize MCP Servers
    # ═══════════════════════════════════════════════════════════════════════════
    - id: "init_infrastructure_server"
      action: "mcp.server.init"
      description: "Initialize infrastructure MCP server (L00)"
      depends_on: ["load_dissolution_manifest"]
      inputs:
        server_name: "axiom_infrastructure_server"
        tools:
          - bootstrap_core
          - kernel_compute
          - emergency_override
          - resource_scheduler
          - memory_allocator
      outputs:
        - infrastructure_server_status

    - id: "init_cognitive_server"
      action: "mcp.server.init"
      description: "Initialize cognitive MCP server (L04-L05)"
      depends_on: ["load_dissolution_manifest"]
      parallel_with: ["init_infrastructure_server"]
      inputs:
        server_name: "axiom_cognitive_server"
        tools:
          - cognitive_analysis
          - pattern_recognition
          - semantic_processor
          - metacognitive_monitor
          - ethics_governance
          - bias_detector
          - fairness_optimizer
      outputs:
        - cognitive_server_status

    - id: "init_governance_server"
      action: "mcp.server.init"
      description: "Initialize governance MCP server (L09-L12)"
      depends_on: ["load_dissolution_manifest"]
      parallel_with: ["init_infrastructure_server"]
      inputs:
        server_name: "axiom_governance_server"
        tools:
          - output_quality
          - system_governance
          - architecture_plan
          - audit_logger
          - policy_engine
          - compliance_monitor
          - system_optimization
          - performance_tuner
          - resource_optimizer
          - meta_strategist
          - self_optimizer
          - emergence_detector
      outputs:
        - governance_server_status

    - id: "init_quantum_server"
      action: "mcp.server.init"
      description: "Initialize quantum MCP server (L13)"
      depends_on: ["load_dissolution_manifest"]
      parallel_with: ["init_infrastructure_server"]
      inputs:
        server_name: "axiom_quantum_server"
        fallback_enabled: true
        tools:
          - vqe_solver
          - qaoa_optimizer
          - qml_engine
          - financial_portfolio
          - financial_risk
          - security_cryptography
      outputs:
        - quantum_server_status

    # ═══════════════════════════════════════════════════════════════════════════
    # STEP 3: Activate Team Members
    # ═══════════════════════════════════════════════════════════════════════════
    - id: "activate_orchestrator"
      action: "agents.activate"
      description: "Activate Holy Grail orchestrator"
      depends_on: ["load_team_config"]
      inputs:
        agent_id: "grail.orchestrator"
        config: "${team_config}"
      outputs:
        - orchestrator_status

    - id: "activate_quantum_flow_master"
      action: "agents.activate"
      description: "Activate Quantum Flow Master"
      depends_on: ["activate_orchestrator"]
      inputs:
        agent_id: "grail.quantum-flow"
        config: "${team_config}"
      outputs:
        - quantum_flow_status

    - id: "activate_ai_experts"
      action: "agents.batch_activate"
      description: "Activate all AI expert agents"
      depends_on: ["activate_orchestrator"]
      parallel_with: ["activate_quantum_flow_master"]
      inputs:
        agents:
          - "ai.architect"
          - "ai.security"
          - "ai.devops"
          - "ai.qa"
          - "ai.data-scientist"
        config: "${team_config}"
      outputs:
        - ai_experts_status

    - id: "activate_autonomous_agents"
      action: "agents.batch_activate"
      description: "Activate all autonomous agents"
      depends_on: ["activate_orchestrator"]
      parallel_with: ["activate_quantum_flow_master"]
      inputs:
        agents:
          - "synergy.self-evolution"
          - "synergy.ecosystem"
          - "autonomous.autopilot"
        config: "${team_config}"
      outputs:
        - autonomous_status

    - id: "activate_pipeline_agents"
      action: "agents.batch_activate"
      description: "Activate instant pipeline agents"
      depends_on: ["activate_orchestrator"]
      parallel_with: ["activate_quantum_flow_master"]
      inputs:
        agents:
          - "instant.input-analysis"
          - "instant.code-generation"
          - "instant.deployment"
          - "instant.optimization"
        config: "${team_config}"
      outputs:
        - pipeline_agents_status

    # ═══════════════════════════════════════════════════════════════════════════
    # STEP 4: Health Check
    # ═══════════════════════════════════════════════════════════════════════════
    - id: "health_check_servers"
      action: "mcp.health_check"
      description: "Health check all MCP servers"
      depends_on:
        - "init_infrastructure_server"
        - "init_cognitive_server"
        - "init_governance_server"
        - "init_quantum_server"
      inputs:
        servers:
          - axiom_infrastructure_server
          - axiom_cognitive_server
          - axiom_governance_server
          - axiom_quantum_server
        timeout_ms: 5000
      outputs:
        - server_health

    - id: "health_check_agents"
      action: "agents.health_check"
      description: "Health check all team members"
      depends_on:
        - "activate_ai_experts"
        - "activate_autonomous_agents"
        - "activate_pipeline_agents"
      inputs:
        timeout_ms: 5000
      outputs:
        - agent_health

    # ═══════════════════════════════════════════════════════════════════════════
    # STEP 5: Generate Boot Report
    # ═══════════════════════════════════════════════════════════════════════════
    - id: "generate_boot_report"
      action: "reports.generate"
      description: "Generate Holy Grail boot report"
      depends_on:
        - "health_check_servers"
        - "health_check_agents"
      inputs:
        template: "grail_boot_report"
        data:
          team: "${team_config}"
          servers: "${server_health}"
          agents: "${agent_health}"
          timestamp: "${execution.start_time}"
      outputs:
        - boot_report
      artifacts:
        - name: "grail_boot_report"
          type: "markdown"

    - id: "emit_boot_complete"
      action: "events.emit"
      description: "Emit boot completion event"
      depends_on: ["generate_boot_report"]
      inputs:
        event_type: "HOLY_GRAIL_BOOT_COMPLETE"
        payload:
          team_id: "holy-grail"
          boot_time_ms: "${execution.duration_ms}"
          servers_active: "${server_health.active_count}"
          agents_active: "${agent_health.active_count}"
          status: "legendary"

  audit:
    enabled: true
    events:
      - "PLAYBOOK_STARTED"
      - "STEP_COMPLETED"
      - "PLAYBOOK_COMPLETED"
      - "ERROR"
